<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>反恐精英2 各插件平台性能简易测试对比</title>
    <link href="/2025/cs2-plugin-framework-tests/"/>
    <url>/2025/cs2-plugin-framework-tests/</url>
    
    <content type="html"><![CDATA[<p>简单对比一下 Counter-Strike 2 各个插件平台的性能。<br>我觉得能逆向能做插件平台的人都好NB。都做出这么多平台了（   </p><p>cs2游戏版本：  14128<br>Metamod 版本：  2.0.0-dev+1374  </p><p>测试的内容很简单，都是制作一个指令，在无人的服务器里，使用 de_inferno 地图。<br>只记录cs2启动后的第一次执行数据，因为多次执行有实体信息缓存机制（   </p><p>获取每个实体的简要属性并组成一个字符串。<br>对每个 info_ 开头的实体 teleport 到目前坐标+一个小 Vector 偏移。<br>生成和 Fire 一个 <code>cs_win_panel_round</code> GameEvent 。<br>以上循环执行 1000 次，计算总需要的时长。    </p><h1 id="结果比较"><a href="#结果比较" class="headerlink" title="结果比较"></a>结果比较</h1><p><img src="/image/cs2_framework_chart1.jpg"></p><h1 id="Plugify-S2-Launcher"><a href="#Plugify-S2-Launcher" class="headerlink" title="Plugify &#x2F; S2-Launcher"></a>Plugify &#x2F; S2-Launcher</h1><p><a href="https://github.com/untrustedmodders/">github</a><br>我按他们的文档试了，但是没法正常运行，就不管了，<br>这包管理做的跟天书一样，感觉好难用。<br>虽然在更新却没有一个 issue ，也没有 star，不知道他们的用户在哪里。  </p><h1 id="ModSharp"><a href="#ModSharp" class="headerlink" title="ModSharp"></a>ModSharp</h1><p><a href="https://github.com/Kxnrl/modsharp-public">github</a><br>版本： 2.1.88 （2025-11-22）   </p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// tt</span><br><span class="hljs-comment">// time: 628 ms. entityCount: 766. infoEntityCount: 44.</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> ECommandAction <span class="hljs-title">OnTTCommand</span>(<span class="hljs-params">StringCommand command</span>)</span><br>&#123;<br>    <span class="hljs-keyword">var</span> sw = Stopwatch.StartNew();<br>    <span class="hljs-built_in">string</span> str;<br>    <span class="hljs-built_in">int</span> entityCount = <span class="hljs-number">0</span>;<br>    <span class="hljs-built_in">int</span> infoEntityCount = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">var</span> entityManager = _sharedSystem.GetEntityManager();<br>    <span class="hljs-keyword">var</span> eventManager = _sharedSystem.GetEventManager();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++)<br>    &#123;<br>        entityCount = <span class="hljs-number">0</span>;<br>        infoEntityCount = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">var</span> posAdd = <span class="hljs-keyword">new</span> Vector(i / <span class="hljs-number">999.0f</span>, i / <span class="hljs-number">-999.0f</span>, i / <span class="hljs-number">999.0f</span>);<br><br>        IBaseEntity? ent = <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)<br>        &#123;<br>            ent = entityManager.FindEntityByClassname(ent, <span class="hljs-string">&quot;*&quot;</span>);<br>            <span class="hljs-keyword">if</span> (ent != <span class="hljs-literal">null</span> &amp;&amp; ent.IsValid())<br>            &#123;<br>                entityCount += <span class="hljs-number">1</span>;<br>                <span class="hljs-keyword">if</span> (ent.Classname.StartsWith(<span class="hljs-string">&quot;info_&quot;</span>))<br>                &#123;<br>                    ent.Teleport(ent.GetAbsOrigin() + posAdd);<br>                    infoEntityCount += <span class="hljs-number">1</span>;<br>                &#125;<br>                str = <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;ent.Index&#125;</span> <span class="hljs-subst">&#123;ent.Classname&#125;</span> <span class="hljs-subst">&#123;ent.Health&#125;</span> <span class="hljs-subst">&#123;ent.GetAbsOrigin()&#125;</span> <span class="hljs-subst">&#123;ent.GetAbsAngles()&#125;</span>&quot;</span>;<br>            &#125;<br>            <span class="hljs-keyword">else</span><br>            &#123;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (eventManager.CreateEvent(<span class="hljs-string">&quot;cs_win_panel_round&quot;</span>, <span class="hljs-literal">true</span>) <span class="hljs-keyword">is</span> IGameEvent e)<br>        &#123;<br>            e.SetString(<span class="hljs-string">&quot;funfact_token&quot;</span>, <span class="hljs-string">&quot;aaa bbb ccc&quot;</span>);<br>            e.Fire(<span class="hljs-literal">false</span>);<br>        &#125;<br>    &#125;<br>    sw.Stop();<br>    Console.WriteLine(<span class="hljs-string">$&quot;time: <span class="hljs-subst">&#123;sw.ElapsedMilliseconds:<span class="hljs-number">0</span>&#125;</span> ms. entityCount: <span class="hljs-subst">&#123;entityCount&#125;</span>. infoEntityCount: <span class="hljs-subst">&#123;infoEntityCount&#125;</span>.&quot;</span>);<br><br>    <span class="hljs-keyword">return</span> ECommandAction.Stopped;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="SwiftlyS2"><a href="#SwiftlyS2" class="headerlink" title="SwiftlyS2"></a>SwiftlyS2</h1><p><a href="https://github.com/swiftly-solution/swiftlys2">github</a><br>版本： 1.0.6-beta.14  （2025-12-13）  </p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// sw_tt</span><br><span class="hljs-comment">// 单纯版：  time: 804 ms. entityCount: 767. infoEntityCount: 44.</span><br><span class="hljs-comment">// METAMOD 版本： time: 799 ms. entityCount: 767. infoEntityCount: 44.</span><br>[<span class="hljs-meta">Command(<span class="hljs-string">&quot;tt&quot;</span>)</span>]<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnTTCommand</span>(<span class="hljs-params">ICommandContext context</span>)</span><br>&#123;<br>    <span class="hljs-keyword">if</span> (context.IsSentByPlayer) &#123; <span class="hljs-keyword">return</span>; &#125;<br>    <span class="hljs-keyword">var</span> sw = Stopwatch.StartNew();<br>    <span class="hljs-built_in">string</span> str;<br>    <span class="hljs-built_in">int</span> entityCount = <span class="hljs-number">0</span>;<br>    <span class="hljs-built_in">int</span> infoEntityCount = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++)<br>    &#123;<br>        entityCount = <span class="hljs-number">0</span>;<br>        infoEntityCount = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">var</span> posAdd = <span class="hljs-keyword">new</span> Vector(i / <span class="hljs-number">999f</span>, -i / <span class="hljs-number">999f</span>, i / <span class="hljs-number">999f</span>);<br>        <span class="hljs-keyword">var</span> allEnts = Core.EntitySystem.GetAllEntities();<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> e <span class="hljs-keyword">in</span> allEnts)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (!e.IsValid) &#123; <span class="hljs-keyword">continue</span>; &#125;<br>            entityCount += <span class="hljs-number">1</span>;<br>            <span class="hljs-keyword">var</span> ent = e.As&lt;CBaseEntity&gt;();<br>            <span class="hljs-keyword">if</span> (ent.DesignerName.StartsWith(<span class="hljs-string">&quot;info_&quot;</span>))<br>            &#123;<br>                ent.Teleport(ent.AbsOrigin! + posAdd, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br>                infoEntityCount += <span class="hljs-number">1</span>;<br>            &#125;<br>            str = <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;ent.Index&#125;</span> <span class="hljs-subst">&#123;ent.DesignerName&#125;</span> <span class="hljs-subst">&#123;ent.Health&#125;</span> <span class="hljs-subst">&#123;ent.AbsOrigin&#125;</span> <span class="hljs-subst">&#123;ent.AbsRotation&#125;</span>&quot;</span>;<br>        &#125;<br>        Core.GameEvent.Fire&lt;EventCsWinPanelRound&gt;(ev =&gt;<br>        &#123;<br>            ev.FunfactToken = <span class="hljs-string">&quot;aaa bbb ccc&quot;</span>;<br>            ev.DontBroadcast = <span class="hljs-literal">false</span>;<br>        &#125;);<br>    &#125;<br>    sw.Stop();<br>    Console.WriteLine(<span class="hljs-string">$&quot;time: <span class="hljs-subst">&#123;sw.ElapsedMilliseconds:<span class="hljs-number">0</span>&#125;</span> ms. entityCount: <span class="hljs-subst">&#123;entityCount&#125;</span>. infoEntityCount: <span class="hljs-subst">&#123;infoEntityCount&#125;</span>.&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="CS2fixes"><a href="#CS2fixes" class="headerlink" title="CS2fixes"></a>CS2fixes</h1><p><a href="https://github.com/Source2ZE/CS2Fixes">github</a><br>严格意义上这不算是个插件平台，给原版 cs2fixes 加了一点代码。<br>版本：  v1.16.6  （2025-12-06）   </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// c_tt </span><br><span class="hljs-comment">// time: 546 ms. entityCount: 767. infoEntityCount: 44.</span><br><span class="hljs-built_in">CON_COMMAND_CHAT_FLAGS</span>(tt, <span class="hljs-string">&quot;test&quot;</span>, ADMFLAG_GENERIC)<br>&#123;<br><span class="hljs-keyword">auto</span> start = std::chrono::high_resolution_clock::<span class="hljs-built_in">now</span>();<br><span class="hljs-type">char</span> str[<span class="hljs-number">1023</span>];<br><span class="hljs-type">int</span> entityCount = <span class="hljs-number">0</span>;<br><span class="hljs-type">int</span> infoEntityCount = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">auto</span> prefix = <span class="hljs-string">&quot;info_&quot;</span>;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++)<br>&#123;<br>Vector* posAdd = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Vector</span>(i / <span class="hljs-number">999.0f</span>, i / <span class="hljs-number">-999.0f</span>, i / <span class="hljs-number">999.0f</span>);<br><br>entityCount = <span class="hljs-number">0</span>;<br>infoEntityCount = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">auto</span> iter = <span class="hljs-keyword">new</span> <span class="hljs-built_in">EntityInstanceIter_t</span>();<br><span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)<br>&#123;<br><span class="hljs-keyword">auto</span> e = iter-&gt;<span class="hljs-built_in">Next</span>();<br><span class="hljs-keyword">if</span> (!e) <span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">auto</span> ent = <span class="hljs-built_in">reinterpret_cast</span>&lt;CBaseEntity*&gt;(e);<br><span class="hljs-keyword">auto</span> origin = ent-&gt;<span class="hljs-built_in">GetAbsOrigin</span>();<br><span class="hljs-keyword">auto</span> angle = ent-&gt;<span class="hljs-built_in">GetAbsRotation</span>();<br><span class="hljs-keyword">auto</span> cls = ent-&gt;<span class="hljs-built_in">GetClassname</span>();<br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">strncmp</span>(cls, prefix, <span class="hljs-built_in">strlen</span>(prefix)) == <span class="hljs-number">0</span>)<br>&#123;<br>origin.x += posAdd-&gt;x;<br>origin.y += posAdd-&gt;y;<br>origin.z += posAdd-&gt;z;<br>ent-&gt;<span class="hljs-built_in">Teleport</span>(&amp;origin, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);<br>infoEntityCount += <span class="hljs-number">1</span>;<br>&#125;<br>entityCount += <span class="hljs-number">1</span>;<br><span class="hljs-built_in">V_snprintf</span>(str, <span class="hljs-built_in">sizeof</span>(str), <span class="hljs-string">&quot;%d %s %d pos:%f %f %f ang: %f %f %f&quot;</span>, ent-&gt;<span class="hljs-built_in">GetEntityIndex</span>().<span class="hljs-built_in">Get</span>(), cls, ent-&gt;<span class="hljs-built_in">m_iHealth</span>(), origin.x, origin.y, origin.z, angle.x, angle.y, angle.z);<br>&#125;<br><br>IGameEvent* pEvent = g_gameEventManager-&gt;<span class="hljs-built_in">CreateEvent</span>(<span class="hljs-string">&quot;cs_win_panel_round&quot;</span>);<br><span class="hljs-keyword">if</span> (!pEvent) <span class="hljs-keyword">return</span>;<br>pEvent-&gt;<span class="hljs-built_in">SetString</span>(<span class="hljs-string">&quot;funfact_token&quot;</span>, <span class="hljs-string">&quot;aaa bbb ccc&quot;</span>);<br>g_gameEventManager-&gt;<span class="hljs-built_in">FireEvent</span>(pEvent, <span class="hljs-literal">false</span>);<br>&#125;<br><span class="hljs-keyword">auto</span> end = std::chrono::high_resolution_clock::<span class="hljs-built_in">now</span>();<br><span class="hljs-keyword">auto</span> duration_ms = std::chrono::<span class="hljs-built_in">duration_cast</span>&lt;std::chrono::milliseconds&gt;(end - start);<br><span class="hljs-built_in">Message</span>(<span class="hljs-string">&quot;time: %d ms. entityCount: %d. infoEntityCount: %d.\n&quot;</span>, duration_ms.<span class="hljs-built_in">count</span>(), entityCount, infoEntityCount);<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="CounterStrikeSharp"><a href="#CounterStrikeSharp" class="headerlink" title="CounterStrikeSharp"></a>CounterStrikeSharp</h1><p><a href="https://github.com/roflmuffin/CounterStrikeSharp">github</a><br>版本： v1.0.349 （2025-12-12）   </p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// tt  1.5  -2.5  3.5</span><br><span class="hljs-comment">// time: 2298 ms. entityCount: 767. infoEntityCount: 44.</span><br>[<span class="hljs-meta">ConsoleCommand(<span class="hljs-string">&quot;tt&quot;</span>)</span>]<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CommandTT</span>(<span class="hljs-params">CCSPlayerController? caller, CommandInfo command</span>)</span><br>&#123;<br>    <span class="hljs-keyword">if</span> (caller != <span class="hljs-literal">null</span>) &#123; <span class="hljs-keyword">return</span>; &#125;<br>    <span class="hljs-keyword">var</span> sw = Stopwatch.StartNew();<br>    <span class="hljs-built_in">string</span> str;<br>    <span class="hljs-built_in">int</span> entityCount = <span class="hljs-number">0</span>;<br>    <span class="hljs-built_in">int</span> infoEntityCount = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++)<br>    &#123;<br>        entityCount = <span class="hljs-number">0</span>;<br>        infoEntityCount = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">var</span> posAdd = <span class="hljs-keyword">new</span> Vector(i / <span class="hljs-number">999.0f</span>, i / <span class="hljs-number">-999.0f</span>, i / <span class="hljs-number">999.0f</span>);<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> e <span class="hljs-keyword">in</span> Utilities.GetAllEntities())<br>        &#123;<br>            <span class="hljs-keyword">if</span> (!e.IsValid) &#123; <span class="hljs-keyword">continue</span>; &#125;<br>            entityCount += <span class="hljs-number">1</span>;<br>            <span class="hljs-keyword">var</span> ent = e.As&lt;CBaseEntity&gt;();<br>            <span class="hljs-keyword">if</span> (ent.DesignerName.StartsWith(<span class="hljs-string">&quot;info_&quot;</span>))<br>            &#123;<br>                ent.Teleport(ent.AbsOrigin! + posAdd);<br>                infoEntityCount += <span class="hljs-number">1</span>;<br>            &#125;<br>            str = <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;ent.Index&#125;</span> <span class="hljs-subst">&#123;ent.DesignerName&#125;</span> <span class="hljs-subst">&#123;ent.Health&#125;</span> <span class="hljs-subst">&#123;ent.AbsOrigin&#125;</span> <span class="hljs-subst">&#123;ent.AbsRotation&#125;</span>&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">var</span> ev = <span class="hljs-keyword">new</span> EventCsWinPanelRound(<span class="hljs-literal">true</span>);<br>        ev.FunfactToken = <span class="hljs-string">&quot;aaa bbb ccc&quot;</span>;<br>        ev.FireEvent(<span class="hljs-literal">false</span>);<br>    &#125;<br>    sw.Stop();<br>    Console.WriteLine(<span class="hljs-string">$&quot;time: <span class="hljs-subst">&#123;sw.ElapsedMilliseconds:<span class="hljs-number">0</span>&#125;</span> ms. entityCount: <span class="hljs-subst">&#123;entityCount&#125;</span>. infoEntityCount: <span class="hljs-subst">&#123;infoEntityCount&#125;</span>.&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>cs2</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>我的 FFMPEG UI</title>
    <link href="/2025/ffmpegui/"/>
    <url>/2025/ffmpegui/</url>
    
    <content type="html"><![CDATA[<p>我试用了几个 FFMPEG 的 gui 软件，发现他们都不能做到套着文件夹结构进行转码工作。<br>比如我有一些图片文件，结构化的分布在多个层级的文件夹里，他们就做不到什么结构进去，什么结构出来。<br>对这些一般般的 GUI 来说，他们只能统一输出到另外一个地方。<br>就算可以输出到原文件夹，也会给文件名加上奇奇怪怪的后缀。<br>而且这些 GUI 的操作手感都不好。   </p><p>最初我还可以用 ps1 写脚本糊弄一下，后面用的越来越频繁。我就自己做了一个简易轮子。<br>支持什么文件夹结构进，什么文件夹结构出。<br>参数全靠自己写。然后保存成模板。<br>也没有转码进度显示，就是个纯粹的 .bat 生成和呼叫工具。   </p><p>我记得我用了某某软件，他就死脑筋的单线程转码一堆图片，<br>然后比如说我要转码到 webp 。但是有 1.jpg 和 1.png 同时存在，<br>他会转码到半路上，才会报错 1.webp 已经存在，然后也进行不下去了，半途而废了。<br>我的 UI 会只转码修改时间最新的那个，并且开始工作的时候就已经会提出警报了。   </p><p>我还试用过另外一个开源 GUI ，他那个多任务同时管理有 BUG ，<br>我同时多开一点就报错到死掉。太笨了，我也懒得给他发 issue 。<br>而我这个简简单单，多少个任务同时进行，就生成多少个 .bat 文件，然后同时把他们运行起来就完事了。<br>如果有安装 windows Terminal 可嵌入到一个窗口里的多个标签页。<br>cmd 窗口的标题会显示一个简易的进度。   </p><p>源码：<br><a href="https://github.com/chenbuyi2019/BuyiFFmpegUI">https://github.com/chenbuyi2019/BuyiFFmpegUI</a>   </p><p>截图：<br><img src="/image/ffmpegui.webp">   </p>]]></content>
    
    
    
    <tags>
      
      <tag>code</tag>
      
      <tag>.net</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>集齐了昆明14个区县的邮戳</title>
    <link href="/2025/postmarks-km/"/>
    <url>/2025/postmarks-km/</url>
    
    <content type="html"><![CDATA[<p>我是一个昆明人，我自豪。<br>昆明一共有14个区县，每个我都去了一趟，并盖戳留念。   </p><p><img src="/image/postmarks_km.webp">  </p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>反恐精英2 mdmp 文件里内嵌日志的解读</title>
    <link href="/2025/cs2-mdmp-view/"/>
    <url>/2025/cs2-mdmp-view/</url>
    
    <content type="html"><![CDATA[<p>cs2.exe 崩溃之后，有概率生成 mdmp 文件，之前我只用 Visual Studio 和 windbg 去打开 mdmp 文件。<br>都没有发挥出 mdmp 文件的真实价值。   </p><p>与其打开 Visual Studio 或 windbg 在那瞎猜，不如直接用代码编辑器打开（甚至记事本）。<br>然后搜索文本 <code>Console History (reversed)</code> ，这样就可以看到一大段明文日志。<br>这个日志是新的在前面，老的在后面进行排布的。 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs log">Console History (reversed)<br><br>2852(200.822541):  FATAL ERROR: attempting to render with error material for &#x27;materials/error.vmat&#x27;<br>2851(200.822512):  FATAL ERROR: attempting to render with error material for &#x27;materials/error.vmat&#x27;<br>2850(200.822495):  FATAL ERROR: attempting to render with error material for &#x27;materials/error.vmat&#x27;<br>2849(200.822487):  FATAL ERROR: attempting to render with error material for &#x27;materials/error.vmat&#x27;<br>2848(200.822467):  FATAL ERROR: attempting to render with error material for &#x27;materials/error.vmat&#x27;<br>2847(200.822231):  Sending Steam API content notification<br>2846(200.822209):  C:\buildworker\csgo_rel_win64\build\src\filesystem\basefilesystem.cpp (7062) : AssertMsg Failed in function CBaseFileSystem::MarkContentCorrupt():<br>Content being marked corrupt.  bMissingFilesOnly = false, pFile specified as &#x27;NULL&#x27;, reason: &#x27;FATAL ERROR: attempting to render with error material for &#x27;materials/error.vmat&#x27;&#x27;<br>2845(200.822203):  Sending Steam API content notification<br></code></pre></td></tr></table></figure><p>如上文我们遇到的是 <code>materials/error.vmat</code><br>这是个非常司马的难题，因为 cs2 遇到丢失的 vmat 贴图它不会忽略、也不会在 UI 里告诉你丢失了什么，<br>它只会弹出这个该死的弹窗。<br>然后强制启动 steam 的验证游戏完整性，逼你等上几分钟才能重启游戏。<br>在这里有个比较快的定位丢失文件的办法，就是从 mdmp 提供的日志里查看。<br>从日志的文本里搜索正则 <code>Failed loading resource .+\.vmat_c</code> 就可以直接看见到底哪个 <code>.vmat_c</code> 丢失了。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs log">2252(194.518007):   [ExG积分商城] 你得到了 4 积分：僵尸通关<br>2251(193.816209):  Failed loading resource &quot;knif/kukri_beast.vmat_c&quot; (ERROR_FILEOPEN: File not found)<br></code></pre></td></tr></table></figure><p>在实战中，这个办法的用途也没有想象中的大，针对 error.vmat 难题是够用了。<br>可以快速从玩家闪退提供的文件里找到问题来源。以及一些可能的地图 IO 类导致的服务器崩溃。<br>使用插件特地实现的一些崩溃， mdmp 日志能提供的帮助反而较少。</p>]]></content>
    
    
    
    <tags>
      
      <tag>cs2</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GMod 中 NPC AI 路径 ain 文件版本控制问题</title>
    <link href="/2024/gmod-ain/"/>
    <url>/2024/gmod-ain/</url>
    
    <content type="html"><![CDATA[<p>半条命2 和 GMod 中的 NPC AI 路径点使用的是 <a href="https://developer.valvesoftware.com/wiki/Nodegraph">Nodegraph</a> 技术，<br>对应的文件是 <a href="https://developer.valvesoftware.com/wiki/AIN">.ain</a> 文件，保存在 <code>maps/graphs</code> 文件夹里。   </p><p>当游戏觉得 .ain 文件版本和 .bsp 地图版本不对应的时候，游戏就会自动根据地图内的 <code>info_node</code> 系列实体生成新的 .ain 文件。<br>就是刚刚进入游戏的时候，会看见 <code>Node graph out of date. Rebuilding...</code> 这句话显示在屏幕上。   </p><p>有一些 mod 作者做的地图没有在地图里放置对应的 node 实体，导致 NPC 无法正常识路。<br>.ain 文件可以脱离于地图内容，直接单独生成。<br>比较好用的 gmod 工具是 <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=2004023752">Nodegraph Editor Expansion</a> 。    </p><p>如果是 workshop 订阅来的 bsp 地图，最简单，<br>只要 .ain 文件存在，它就认。没有文件版本控制问题。   </p><p>如果是裸的 bsp 文件直接放在 maps 文件夹里，<br>gmod 就会以 <strong>文件修改时间</strong> 为基准，决定是否重新建立。<br>就是这么简单粗暴，我还以为是根据文件内部标注的 hash 决定的，结果只是文件修改时间而已。   </p><p>比如我弄了一个 <code>fff.bsp</code> ，需要放在服务器 maps 里，它的贴图没有打包进去。<br>我们把贴图一并打包进去，然后做成 <code>fff.bsp.bz2</code> 放在 CDN 里给玩家下载。   </p><p>这里打包好贴图的 <code>fff.bsp</code> 的文件修改时间就会是我编辑打包的时间，比如说 12月1日。<br><code>fff.bsp</code> 刚好没有 node 实体， <code>fff.ain</code> 是第三方作者做的，我下载来的文件是 12KB， 3月1日 。<br>我发现一进游戏， gmod 就会自动重建 ain 文件， <code>fff.ain</code> 就被覆盖成了一个空白文件，只有 16 Bytes 。   </p><p>解决办法有两个：   </p><p>第一，关闭游戏自动重建，在 <code>server.cfg</code> 或者 <code>autoexec.cfg</code> 里加入 <code>ai_norebuildgraph 1</code> 参数。<br>拆开来读就是  <code>ai no rebuild graph</code><br>这样就以后全部的地图都不会主动新建 .ain 文件了。<br>对独立服务器来说也还行，因为我们可以用本地单人游戏做好的 .ain 复制到服务器。不需要服务器自己建立。   </p><p>第二，修改文件时间。反正时间只是文件系统给文件打的标签而已。<br>只要让 gmod 觉得这个 .ain 的修改时间晚于 .bsp 的修改时间即可。<br>可以把 .bsp 改早，也可以把 .ain 改晚。<br>我们可以用 Powershell 指令快速改时间：   </p><figure class="highlight pwsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pwsh"><span class="hljs-comment"># 修改为当前电脑时间</span><br>(<span class="hljs-built_in">Get-Item</span> <span class="hljs-string">&quot;.\fff.ain&quot;</span>).LastWriteTime = (<span class="hljs-built_in">Get-Date</span>) <br><span class="hljs-comment"># 修改为任意指定时间。</span><br>(<span class="hljs-built_in">Get-Item</span> <span class="hljs-string">&quot;.\fff.ain&quot;</span>).LastWriteTime = (<span class="hljs-built_in">Get-Date</span> <span class="hljs-string">&quot;2039-12-19&quot;</span>) <br></code></pre></td></tr></table></figure><p>但是不管怎么做，都意味着，我们需要自己备份 .ain 文件，<br>指不定这个游戏又觉得 .bsp 更新了或者没有禁用自动生成参数又给我覆盖了。   </p>]]></content>
    
    
    
    <tags>
      
      <tag>gmod</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Buyi Toolbar</title>
    <link href="/2024/toolbar-app/"/>
    <url>/2024/toolbar-app/</url>
    
    <content type="html"><![CDATA[<p>解决 windows 11 砍掉的任务栏-工具栏功能。<br>支持文件夹嵌套。   </p><p>运行库： .NET Framework 4.8   </p><p>启动办法： 把指定文件夹作为启动项参数的第一个。如果带空格需要带双引号。   </p><p>cmd 启动示例：</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-built_in">start</span> &quot;&quot; &quot;BuyiToolbar.exe&quot; &quot;C:\Users\Buyi\Apps&quot;<br></code></pre></td></tr></table></figure><p>源码： <a href="https://github.com/chenbuyi2019/Buyi-Toolbar">github</a>   </p><p>效果截图：<br><img src="/image/buyi_toolbar.webp">  </p>]]></content>
    
    
    
    <tags>
      
      <tag>code</tag>
      
      <tag>.net</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>反恐精英2：控制台飘太远了怎么办</title>
    <link href="/2024/cs2-console-fix-pos/"/>
    <url>/2024/cs2-console-fix-pos/</url>
    
    <content type="html"><![CDATA[<p>该死的 Valve ，如果你在使用 Counter-Strike 2 的控制台的时候，<br>不小心拖拽控制台窗口拖到了游戏界面的外面去。<br>尤其是最顶上或者最下面。<br>你就很可能再也拖拽不回来了。    </p><p>解决办法：<br>先关闭游戏，<br>找到自己的 steam 好友编码，<br>然后去 <code>steam安装目录/userdata/好友编码/730/local/cfg</code> 这个文件夹，<br>找到 <code>cs2_machine_convars.vcfg</code> 这个配置文件，用代码编辑器或记事本打开。  </p><p>在里面搜索 <code>panorama_console_position_and_size</code> ，找到后把这一行删掉，保存修改。<br>因为这一行是存储着控制台的位置和大小。   </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cfg">&quot;panorama_console_position_and_size&quot;&quot;253.20|-22.80|1052.40|300.00&quot;<br></code></pre></td></tr></table></figure><p>现在重启游戏，就是恢复默认的控制台大小了。   </p>]]></content>
    
    
    
    <tags>
      
      <tag>cs2</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>反恐精英2：我是怎么掉线的</title>
    <link href="/2024/cs2-client-log-parse/"/>
    <url>/2024/cs2-client-log-parse/</url>
    
    <content type="html"><![CDATA[<p>司马 Valve 给 Counter-Strike 2 更新了个啥玩意之后，玩家从服务器掉线就不知道理由了。<br>本来应该写掉线理由的框变成了个空白框。   </p><p>特地做此工具，用来解析游戏控制台日志，从而知道掉线给的是啥理由。   </p><p>请在掉线后，全选复制你的控制台日志，然后粘贴到这里，并点击解析。  </p><div><textarea id="txtInput"></textarea><p><button id="btnParse">解析</button></p><div id="divResult"></div><script src="/script/cs2-client-log-parse.js"></script></div><p>源码<a href="https://github.com/chenbuyi2019/blog2309/blob/master/script/cs2-client-log-parse/main.ts">点我</a>。   </p>]]></content>
    
    
    
    <tags>
      
      <tag>code</tag>
      
      <tag>cs2</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ConEmu: 一次性启动和托管多个控制台程序</title>
    <link href="/2024/mulit-cmd/"/>
    <url>/2024/mulit-cmd/</url>
    
    <content type="html"><![CDATA[<p>我写了好多软件都是控制台程序，让它们在 windows 任务栏里晃来晃去不是个好主意。<br>在实际工作中，我需要一个软件来托管这些控制台程序。   </p><p>我选择了 <a href="https://conemu.github.io/">ConEmu</a> 来解决这个问题，我用它来实现：   </p><ol><li>把各个控制台窗口变成标签页</li><li>一次性打开多个控制台程序</li><li>防误触关闭窗口，有个关闭前对话框</li></ol><p>具体就不展开讲了，非常易用的一个控制台 UI 软件。   </p><p>一次性打开多个控制台程序需要使用以下启动参数：   </p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">ConEmu64.exe -runlist ^&gt;  <span class="hljs-built_in">cmd</span> /k &quot;D:\a.exe&quot; ^|^|^| <span class="hljs-built_in">cmd</span> /k &quot;D:\b.exe&quot; ^|^|^| <span class="hljs-built_in">cmd</span> /k &quot;D:\c.exe&quot;  <br></code></pre></td></tr></table></figure><p><code>cmd /k </code> 的好处是支持在标签页里 ctrl+C 然后保留这个标签页。   </p><p>或者不套 cmd 来执行   </p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">ConEmu64.exe -runlist ^&gt; &quot;D:\a.exe&quot; ^|^|^| &quot;D:\b.exe&quot; ^|^|^| &quot;D:\c.exe&quot;  <br></code></pre></td></tr></table></figure><p>你说为什么不用 Windows Terminal ，答案是服务器的 windows 不方便安装 windows store app  。<br>而且 ConEmu 还支持把现有的控制台窗口 attach 塞进去。   </p>]]></content>
    
    
    
    <tags>
      
      <tag>code</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GMod Lua utf8.sub 性能问题</title>
    <link href="/2024/gmod-lua-utf8sub/"/>
    <url>/2024/gmod-lua-utf8sub/</url>
    
    <content type="html"><![CDATA[<p>我本来在做一个简易的日志输出，日志字符串达到一定长度之后，就把字符串裁切只留下后面一半。<br>我不经意间使用了 <code>utf8.sub()</code> 来裁，然后我发现游戏过程中莫名其妙就卡顿几十秒，然后就恢复，也不像是我哪里有逻辑死循环。<br>经过反复 <code>print()</code> 来找卡顿的实际位置，我终于找到了原因，就是这个 log 裁切的问题。  </p><p>Gmod Wiki 里说 <a href="https://wiki.facepunch.com/gmod/utf8.sub">utf8.sub()</a> 比较吃性能，不要在逐帧运行的部分里使用。<br>可我没想到你这性能问题这么大啊。   </p><p>下面是测试代码和测试结果：   </p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs lua">concommand.Add(<br>    <span class="hljs-string">&quot;test1&quot;</span>,<br>    <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span><br>        <span class="hljs-keyword">local</span> t1 = SysTime()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;start&quot;</span>)<br>        <span class="hljs-keyword">local</span> str1 = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-keyword">for</span> i = <span class="hljs-number">1</span>, <span class="hljs-number">199</span> <span class="hljs-keyword">do</span><br>            str1 = str1 .. <span class="hljs-string">&quot;甲甲甲abc abc== 123456123 甲甲甲 abc 123456123甲甲&quot;</span><br>        <span class="hljs-keyword">end</span><br><br>        <span class="hljs-keyword">local</span> t2 = SysTime()<br>        <span class="hljs-built_in">print</span>(Format(<span class="hljs-string">&quot;拼字符串 用时 %.3f  文本长度: %d %d&quot;</span>, t2 - t1, #str1, utf8.<span class="hljs-built_in">len</span>(str1)))<br>        <span class="hljs-keyword">local</span> str2 = <span class="hljs-built_in">string</span>.<span class="hljs-built_in">sub</span>(str1, <span class="hljs-number">9999</span>)<br>        <span class="hljs-keyword">local</span> t3 = SysTime()<br>        <span class="hljs-built_in">print</span>(Format(<span class="hljs-string">&quot;string.sub 用时 %.3f  文本长度: %d&quot;</span>, t3 - t2, #str2))<br>        <span class="hljs-keyword">local</span> str3 = utf8.<span class="hljs-built_in">sub</span>(str1, <span class="hljs-number">5000</span>)<br>        <span class="hljs-keyword">local</span> t4 = SysTime()<br>        <span class="hljs-built_in">print</span>(Format(<span class="hljs-string">&quot;utf8.sub 用时 %.3f  文本长度: %d&quot;</span>, t4 - t3, #str3))<br>    <span class="hljs-keyword">end</span><br>)<br><br><span class="hljs-comment">-- 本地单人游戏 intel i7-12650H</span><br><span class="hljs-comment">-- start</span><br><span class="hljs-comment">-- 拼字符串 用时 0.000  文本长度: 11542 8358</span><br><span class="hljs-comment">-- string.sub 用时 0.000  文本长度: 1544</span><br><span class="hljs-comment">-- utf8.sub 用时 10.642  文本长度: 4637</span><br></code></pre></td></tr></table></figure><p>8358 个字符（11542 字节）的字符串裁掉一半就要花 10 秒。<br>这也 tmd 太慢了吧。   </p><p><code>string.sub()</code> 是像切割 byte[] 一样切割字符串， <code>utf8.sub()</code> 是先把字符串拆成一个个 utf8 字符，然后再组。<br>非必要不使用，还是老老实实用 <code>string.sub</code> 吧，开头有两个乱码字符没什么大不了的（   </p>]]></content>
    
    
    
    <tags>
      
      <tag>code</tag>
      
      <tag>gmod</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Counter-Strike 2 玩家进服退服时的状态一览</title>
    <link href="/2024/cs2-player-states/"/>
    <url>/2024/cs2-player-states/</url>
    
    <content type="html"><![CDATA[<p>本文使用的是 CounterStrikeSharp 和 CS2Fixes 搭配进行的研究。<br>用于确定反恐精英2里玩家进出服务器时候的状态。   </p><p>主要还是因为玩家的状态太迷惑了。<br>从连接服务器到进入服务器，再到完成 steam 验证，再到退出服务器，再到重新连接服务器。<br>（玩家退服之后 Controller 实体还在，就很神奇）   </p><p>合理识别这些玩家状态很重要，因为对状态不正常的玩家进行操作会导致出错甚至崩溃。   </p><style>    .green {        color: green;    }    .red {        color: red;    }</style><p>注意，下表中的 <code>OnClientAuthorized</code> 的顺序位置仅供参考，因为实际中网络不畅时，玩家验证可能很迟才发生。   </p><table style="font-size:small;">    <thead>    <tr>        <td>情况</td>        <td>Controller</td>        <td>Connected</td>        <td>UserId</td>        <td>PrintToConsole</td>        <td>PlayerPawn</td>    </tr>    </thead>    <tbody>    <tr>        <td>第1次进<br>OnClientConnect</td>        <td>null</td>        <td>无</td>        <td>无</td>        <td>不测试</td>        <td>null</td>    </tr>    <tr>        <td>第1次进<br>OnClientConnected</td>        <td>Valid</td>        <td>PlayerConnecting</td>        <td>0</td>        <td>OK</td>        <td>null</td>    </tr>    <tr>        <td>第1次进<br>OnClientAuthorized</td>        <td>Valid</td>        <td>PlayerConnecting</td>        <td>0</td>        <td>OK</td>        <td>null</td>    </tr>    <tr>        <td>第1次进<br>OnClientPutInServer</td>        <td>Valid</td>        <td>PlayerConnecting</td>        <td>0</td>        <td>OK</td>        <td>Valid</td>    </tr>    <tr>        <td>第1次进<br>OnClientPutInServer<br>之后第1帧</td>        <td>Valid</td>        <td class="green">PlayerConnected</td>        <td>0</td>        <td>OK</td>        <td>Valid</td>    </tr>    <tr>        <td>第1次退<br>OnClientDisconnect</td>        <td>Valid</td>        <td class="green">PlayerConnected</td>        <td>0</td>        <td>执行，但玩家收不到</td>        <td>Valid</td>    </tr>    <tr>        <td>第1次退<br>OnClientDisconnectPost</td>        <td>Valid</td>        <td>PlayerDisconnected</td>        <td>0</td>        <td>执行，但玩家收不到</td>        <td>Valid</td>    </tr>    <tr>        <td>第1次退<br>OnClientDisconnectPost<br>之后第1帧</td>        <td>Valid</td>        <td>PlayerDisconnected</td>        <td>65535</td>        <td>执行后服务端崩溃</td>        <td>可能是null</td>    </tr>    <tr>        <td>第2次进<br>OnClientConnect</td>        <td>Valid</td>        <td>PlayerDisconnected</td>        <td>0</td>        <td>OK</td>        <td>Valid</td>    </tr>    <tr>        <td>第2次进<br>OnClientConnected</td>        <td>Valid</td>        <td>PlayerReconnecting</td>        <td>0</td>        <td>OK</td>        <td>Valid</td>    </tr>    <tr>        <td>第2次进<br>OnClientAuthorized</td>        <td>Valid</td>        <td>PlayerReconnecting</td>        <td>0</td>        <td>OK</td>        <td>Valid</td>    </tr>    <tr>        <td>第2次进<br>OnClientPutInServer</td>        <td>Valid</td>        <td>PlayerReconnecting</td>        <td>0</td>        <td>OK</td>        <td>Valid</td>    </tr>    <tr>        <td>第2次进<br>OnClientPutInServer<br>之后第1帧</td>        <td>Valid</td>        <td class="green">PlayerConnected</td>        <td>0</td>        <td>OK</td>        <td>Valid</td>    </tr>    <tr>        <td>第2次退<br>OnClientDisconnect</td>        <td>Valid</td>        <td class="green">PlayerConnected</td>        <td>0</td>        <td>执行，但玩家收不到</td>        <td>Valid</td>    </tr>    <tr>        <td>第2次退<br>OnClientDisconnectPost</td>        <td>Valid</td>        <td>PlayerDisconnected</td>        <td>0</td>        <td>执行，但玩家收不到</td>        <td>Valid</td>    </tr>    <tr>        <td>第2次退<br>OnClientDisconnectPost<br>之后第1帧</td>        <td>Valid</td>        <td>PlayerDisconnected</td>        <td>65535</td>        <td>执行后服务端崩溃</td>        <td>可能是null</td>    </tr>    </tbody></table><p><code>PrintToConsole</code> 的服务端崩溃表现为：   </p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cmd">Fatal error. System.AccessViolationException: Attempted to read or write protected memory. This is often an indication that other memory is corrupt.<br><br>   <span class="hljs-built_in">at</span> CounterStrikeSharp.API.Core.Helpers.InvokeNative(IntPtr)<br> <br>   <span class="hljs-built_in">at</span> CounterStrikeSharp.API.Core.ScriptContext.InvokeNativeInternal()<br>   <span class="hljs-built_in">at</span> CounterStrikeSharp.API.Core.ScriptContext.Invoke()<br>   <span class="hljs-built_in">at</span> CounterStrikeSharp.API.Core.NativeAPI.PrintToConsole(Int32, System.String)<br>   <span class="hljs-built_in">at</span> CounterStrikeSharp.API.Core.CCSPlayerController.PrintToConsole(System.String)<br></code></pre></td></tr></table></figure><p>总结：  </p><ol><li>玩家控制器就算是 <code>.IsValid</code> ，依然不可靠，需要检测 <code>.Connected</code> 和 <code>.UserId</code> 。  </li><li><code>.PrintToConsole</code> 需要特别小心的使用，BOT 玩家和离线玩家使用这个函数都会导致崩服。   </li><li><code>OnClientPutInServer</code> 可以在大部分情况下使用，作为玩家进服的检测点，但是里面的玩家状态依然不是 <code>PlayerConnected</code> ，它的下一帧才是。</li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>cs2</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PowerShell 脚本: ffmpeg 批量压缩音频</title>
    <link href="/2024/ffmpeg-ps1-source/"/>
    <url>/2024/ffmpeg-ps1-source/</url>
    
    <content type="html"><![CDATA[<p>前置需求：   </p><ul><li>在环境 PATH 路径里有 <a href="https://ffmpeg.org/">ffmpeg</a> 程序  </li><li>使用 <a href="https://github.com/PowerShell/PowerShell">PowerShell 7+</a>  </li><li>我自己是在 Windows 11 运行， Linux 应该也能跑</li></ul><p>我自己经常会遇到打包在不同文件夹结构里的各式音频文件，<br>需要将它们压缩为统一格式的起源、起源2引擎适用的音频格式。<br>所以写了这个脚本。   </p><p>把需要转换的音频文件放入一个文件夹里，<br>把文件夹路径作为脚本的第一个参数执行。一般就是拖入控制台窗口或者拖到ps1图标上直接执行。<br>压缩好的 MP3 会输出到输入文件夹上层的 compress_xxx 文件夹里。<br>里面的子文件夹结构和文件名会保留下来。   </p><p>不得不说，这一下 shell 语法，一下 c# 语法感觉就是怪。  </p><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs ps1"><span class="hljs-variable">$dir</span> = <span class="hljs-variable">$args</span>[<span class="hljs-number">0</span>]<br><br><span class="hljs-variable">$ErrorActionPreference</span> = <span class="hljs-string">&#x27;Stop&#x27;</span><br><br><span class="hljs-keyword">if</span> (<span class="hljs-operator">-not</span> (<span class="hljs-built_in">Test-Path</span> <span class="hljs-variable">$dir</span> <span class="hljs-literal">-PathType</span> Container)) &#123;<br>    <span class="hljs-built_in">Write-Error</span> <span class="hljs-string">&quot;你输入的文件夹不存在 <span class="hljs-variable">$dir</span>&quot;</span><br>&#125;<br><br><span class="hljs-variable">$dir</span> = [<span class="hljs-type">System.IO.Path</span>]::GetFullPath(<span class="hljs-variable">$dir</span>)<br><span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;输入文件夹 <span class="hljs-variable">$dir</span>&quot;</span><br><span class="hljs-variable">$tm</span> = <span class="hljs-built_in">Get-Date</span> <span class="hljs-literal">-Format</span> <span class="hljs-string">&quot;HH-mm-ss&quot;</span><br><span class="hljs-variable">$dir2</span> = [<span class="hljs-type">System.IO.Path</span>]::Combine(<span class="hljs-variable">$dir</span>, <span class="hljs-string">&quot;../&quot;</span>, <span class="hljs-string">&quot;compress_<span class="hljs-variable">$tm</span>&quot;</span>)<br><span class="hljs-variable">$dir2</span> = [<span class="hljs-type">System.IO.Path</span>]::GetFullPath(<span class="hljs-variable">$dir2</span>)<br><span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;输出文件夹 <span class="hljs-variable">$dir2</span>&quot;</span><br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">Test-Path</span> <span class="hljs-variable">$dir2</span> <span class="hljs-literal">-PathType</span> Container) &#123;<br>    <span class="hljs-built_in">Write-Error</span> <span class="hljs-string">&quot;输出文件夹已经存在了，需要更换 <span class="hljs-variable">$dir2</span>&quot;</span><br>&#125;<br><br><span class="hljs-variable">$allowedExt</span> = <span class="hljs-selector-tag">@</span>(<span class="hljs-string">&quot;.wav&quot;</span>, <span class="hljs-string">&quot;.mp3&quot;</span>, <span class="hljs-string">&quot;.m4a&quot;</span>, <span class="hljs-string">&quot;.mp4&quot;</span>, <span class="hljs-string">&quot;.ogg&quot;</span>)<br><br><span class="hljs-variable">$inputs</span> = <span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-variable">$dir</span> <span class="hljs-literal">-Filter</span> <span class="hljs-string">&quot;*&quot;</span> <span class="hljs-literal">-Recurse</span><br><span class="hljs-variable">$count</span> = <span class="hljs-number">0</span><br><br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$input</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$inputs</span>) &#123;  <br>    <span class="hljs-variable">$ext</span> = <span class="hljs-variable">$input</span>.Extension.ToLower()<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$allowedExt</span>.Contains(<span class="hljs-variable">$ext</span>)) &#123; <span class="hljs-keyword">continue</span> &#125;<br>    <span class="hljs-variable">$relPath</span> = [<span class="hljs-type">System.IO.Path</span>]::GetRelativePath(<span class="hljs-variable">$dir</span>, <span class="hljs-variable">$input</span>.FullName)<br>    <span class="hljs-variable">$outputFile</span> = [<span class="hljs-type">System.IO.Path</span>]::Combine(<span class="hljs-variable">$dir2</span>, <span class="hljs-variable">$relPath</span>)<br>    <span class="hljs-variable">$outputFile</span> = [<span class="hljs-type">System.IO.Path</span>]::ChangeExtension(<span class="hljs-variable">$outputFile</span>, <span class="hljs-string">&quot;.mp3&quot;</span>)<br>    <span class="hljs-variable">$dir3</span> = [<span class="hljs-type">System.IO.Path</span>]::GetDirectoryName(<span class="hljs-variable">$OutputFile</span>)<br>    <span class="hljs-keyword">if</span> (<span class="hljs-operator">-not</span> (<span class="hljs-built_in">Test-Path</span> <span class="hljs-variable">$dir3</span> <span class="hljs-literal">-PathType</span> Container)) &#123;<br>        <span class="hljs-built_in">New-Item</span> <span class="hljs-variable">$dir3</span> <span class="hljs-literal">-ItemType</span> Directory<br>    &#125;<br>    <span class="hljs-built_in">Write-Host</span> <span class="hljs-variable">$outputFile</span> <br>    ffmpeg <span class="hljs-literal">-i</span> <span class="hljs-variable">$input</span>.FullName <span class="hljs-literal">-y</span> <span class="hljs-literal">-c</span>:a libmp3lame <span class="hljs-literal">-ar</span> <span class="hljs-number">44100</span> <span class="hljs-literal">-b</span>:a <span class="hljs-number">96</span>k <span class="hljs-variable">$outputFile</span> <br>    <span class="hljs-keyword">if</span> (<span class="hljs-operator">-not</span>(<span class="hljs-built_in">Test-Path</span> <span class="hljs-variable">$outputFile</span> <span class="hljs-literal">-PathType</span> Leaf)) &#123;<br>        <span class="hljs-built_in">Write-Error</span> <span class="hljs-string">&quot;找不到压缩的音频文件 <span class="hljs-variable">$outputFile</span>&quot;</span><br>    &#125;<br>    <span class="hljs-variable">$count</span> += <span class="hljs-number">1</span><br>&#125;<br><br><span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;工作完成，一共 <span class="hljs-variable">$count</span> 个文件 &quot;</span><br><span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;输出文件夹 <span class="hljs-variable">$dir2</span>&quot;</span><br><br><span class="hljs-comment"># 批量修改音量： -filter: &quot;volume = 8dB&quot;  </span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>code</tag>
      
      <tag>cs2</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>布衣玩通关且没作弊的游戏</title>
    <link href="/2024/games/"/>
    <url>/2024/games/</url>
    
    <content type="html"><![CDATA[<p>记录一下我玩到单人剧情通关，并且没有作弊的游戏。<br>不求高难度也不求百分百全成就全解锁，能不作弊通关已经很开心了（<br>纯剧情解密类就不算了，可以看攻略作弊的（   </p><h1 id="Grand-Theft-Auto"><a href="#Grand-Theft-Auto" class="headerlink" title="Grand Theft Auto"></a>Grand Theft Auto</h1><p>2017 年 4 月 7 日，通关了 GTA 5 。<br>2022 年 1 月 29 日，通关了 GTA 4 本体。<br>2022 年 8 月 17 日，通关了 The Ballad of Gay Tony 。<br>2022 年 10 月 1 日，通关了 The Lost and Damned 。<br>2024 年 7 月 4 日，通关了 GTA III - The Definitive Edition <a href="https://m.weibo.cn/status/Om1RkzUwy">微博</a> 。<br>2024 年 7 月 30 日，通关了 GTA Vice City – The Definitive Edition <a href="https://m.weibo.cn/status/OpYfvxpV0">微博</a>  。<br>2024 年 8 月 20 日，通关了 GTA San Andreas – The Definitive Edition <a href="https://m.weibo.cn/status/OtcsQqGa6">微博</a>  。    </p><p>2025 年 11 月 22 日， Grand Theft Auto V Enhanced 达成 100% 完成度。<a href="https://m.weibo.cn/status/QeL3a9NCn">微博</a>   </p><h1 id="Devil-May-Cry-5"><a href="#Devil-May-Cry-5" class="headerlink" title="Devil May Cry 5"></a>Devil May Cry 5</h1><p>2022 年 10月 22日。   </p><h1 id="Red-Alert-2"><a href="#Red-Alert-2" class="headerlink" title="Red Alert 2"></a>Red Alert 2</h1><p>2023 年 7 月 7 日，红色警戒2 本体 <a href="https://m.weibo.cn/status/N8M945xzX">微博</a><br>2023 年 7 月 12 日，尤里的复仇 苏军线 <a href="https://m.weibo.cn/status/N9yHy2Qn7">微博</a><br>2024 年 8 月 7 日，尤里的复仇 盟军线 <a href="https://m.weibo.cn/status/OrdHv3p2N">微博</a>   </p><h1 id="Red-Alert-1"><a href="#Red-Alert-1" class="headerlink" title="Red Alert 1"></a>Red Alert 1</h1><p>2024 年 1 月 24 日，红色警戒1 苏军线  <a href="https://m.weibo.cn/status/NDlcGjaYP">微博</a><br>2024 年 8 月 27 日，红色警戒1 盟军线  <a href="https://m.weibo.cn/status/OufZq8Apg">微博</a>   </p><h1 id="Half-Life-1"><a href="#Half-Life-1" class="headerlink" title="Half-Life 1"></a>Half-Life 1</h1><p>2023 年 1 月 25 日，<a href="https://m.weibo.cn/status/MpXEugiJj">微博</a>   </p><h1 id="Need-For-Speed"><a href="#Need-For-Speed" class="headerlink" title="Need For Speed"></a>Need For Speed</h1><p>2024 年 7 月 11 日，极品飞车 9 最高通缉 NFS Most Wanted。<br><a href="https://m.weibo.cn/status/On4zlaVrf">微博</a>   </p><h1 id="Cyberpunk-2077"><a href="#Cyberpunk-2077" class="headerlink" title="Cyberpunk 2077"></a>Cyberpunk 2077</h1><p>2025 年 12 月 30 日， <a href="https://m.weibo.cn/status/QkQ4vlFDp">主线</a><br>2026 年 1 月 22 日， DLC <a href="https://m.weibo.cn/status/QoiaBb69M">往日之影</a>  </p><h1 id="Call-Of-Duty"><a href="#Call-Of-Duty" class="headerlink" title="Call Of Duty"></a>Call Of Duty</h1><p>2026 年 2 月 12 日， Modern Warfare® Remastered (2017) （4的重制版） <a href="https://m.weibo.cn/status/QrwrEqzH4">微博</a></p><h1 id="Mafia-四海兄弟"><a href="#Mafia-四海兄弟" class="headerlink" title="Mafia 四海兄弟"></a>Mafia 四海兄弟</h1><p>2026 年 2 月 15 日， <a href="https://m.weibo.cn/status/QrYHFeAw7">四海兄弟: 最终版</a>  </p><h1 id="ICEY"><a href="#ICEY" class="headerlink" title="ICEY"></a>ICEY</h1><p>2017 年 8 月 2 日。   </p><h1 id="Homefront"><a href="#Homefront" class="headerlink" title="Homefront"></a>Homefront</h1><p>2021 年 9 月 20 日。  </p><h1 id="Max-Payne-3"><a href="#Max-Payne-3" class="headerlink" title="Max Payne 3"></a>Max Payne 3</h1><p>2021 年 10 月 9 日。   </p><h1 id="不记得具体时间的"><a href="#不记得具体时间的" class="headerlink" title="不记得具体时间的"></a>不记得具体时间的</h1><ul><li>Minecraft: Java Edition  </li><li>Devil May Cry 4   </li><li>Hitman: Absolution</li><li>Half-Life 2 </li><li>Half-Life 2: Episode One   </li><li>Half-Life 2: Episode Two  </li><li>Counter-Strike: Condition Zero Deleted Scenes</li><li>Sleeping Dogs: Definitive Edition</li><li>Battlefield 1 </li><li>Battlefield 4</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>游戏</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>使用 DNS 记录通过 certbot 认证</title>
    <link href="/2024/lets-encrypt-dns/"/>
    <url>/2024/lets-encrypt-dns/</url>
    
    <content type="html"><![CDATA[<p>由于我自己写的一些网站都没法直接兼容 Let’s Encrypt <a href="https://certbot.eff.org/">certbot</a> 的普通的认证方式。<br>我更倾向于使用 DNS TXT 认证来完成域名验证过程。<br>好处就是根本不需要一台公网服务器，有台电脑就行。也不用干预正在运行的服务器。<br>坏处就是每次等 DNS 解析有点难等，一旦时机没把握好就得重来。    </p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">certbot certonly <span class="hljs-params">--preferred-challenges</span> dns -d <span class="hljs-string">&quot;*.abcd.com&quot;</span> -d <span class="hljs-string">&quot;abcd.com&quot;</span> <span class="hljs-params">--manual</span><br></code></pre></td></tr></table></figure><p>（其实更多是因为我要申请 *.abcd.com 这样的证书，而我不好直接操作 abcd.com 主页服务器。   </p>]]></content>
    
    
    
    <tags>
      
      <tag>code</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Counter-Strike 2 玩家离线理由中文对照表</title>
    <link href="/2024/cs2-disconnect-reasons/"/>
    <url>/2024/cs2-disconnect-reasons/</url>
    
    <content type="html"><![CDATA[<p>注释里的文本大部分来自 <code>csgo/pak01_dir.vpk</code> 里的 <code>resource/csgo_schinese.txt</code><br>参考原文： <a href="https://github.com/alliedmodders/hl2sdk/blob/cs2/common/network_connection.proto">hl2sdk-cs2</a>   </p><div><table><tr>    <td>0</td>    <td>INVALID</td>    <td>（无弹窗）</td></tr><tr>    <td>1</td>    <td>SHUTDOWN</td>    <td>（无弹窗）</td></tr><tr>    <td>2</td>    <td>DISCONNECT_BY_USER</td>    <td>（无弹窗，玩家主动离开）</td></tr><tr>    <td>3</td>    <td>DISCONNECT_BY_SERVER</td>    <td>服务器断开连接。</td></tr><tr>    <td>4</td>    <td>LOST</td>    <td>连接丢失。</td></tr><tr>    <td>5</td>    <td>OVERFLOW</td>    <td>溢出错误</td></tr><tr>    <td>6</td>    <td>STEAM_BANNED</td>    <td>STEAM用户ID被封禁</td></tr><tr>    <td>7</td>    <td>STEAM_INUSE</td>    <td>STEAM用户ID已在此服务器上使用</td></tr><tr>    <td>8</td>    <td>STEAM_TICKET</td>    <td>来自STEAM用户ID的工单无效</td></tr><tr>    <td>9</td>    <td>STEAM_LOGON</td>    <td>需要Steam以加入游戏。请检查您到Steam的连接并重试。</td></tr><tr>    <td>10</td>    <td>STEAM_AUTHCANCELLED</td>    <td>没有Steam登录</td></tr><tr>    <td>11</td>    <td>STEAM_AUTHALREADYUSED</td>    <td>没有Steam登录</td></tr><tr>    <td>12</td>    <td>STEAM_AUTHINVALID</td>    <td>没有Steam登录</td></tr><tr>    <td>13</td>    <td>STEAM_VACBANSTATE</td>    <td>VAC已被安全服务器封禁</td></tr><tr>    <td>14</td>    <td>STEAM_LOGGED_IN_ELSEWHERE</td>    <td>此帐户当前正在另一台机器上登录到Steam。\n请稍后再试。</td></tr><tr>    <td>15</td>    <td>STEAM_VAC_CHECK_TIMEDOUT</td>    <td>您不能在安全服务器上玩游戏的可能原因如下：•您的电脑出现问题，阻止了VAC系统。•您无法与VAC系统保持稳定连接。•您运行的软件在修改游戏或与VAC不兼容。更多信息</td></tr><tr>    <td>16</td>    <td>STEAM_DROPPED</td>    <td>Steam认证失败。您必须连接到Steam才能初始化到游戏服务器。</td></tr><tr>    <td>17</td>    <td>STEAM_OWNERSHIP</td>    <td>这个Steam帐户并未拥有该游戏。请用正确的Steam帐户登录。</td></tr><tr>    <td>18</td>    <td>SERVERINFO_OVERFLOW</td>    <td>信息数据溢出</td></tr><tr>    <td>19</td>    <td>TICKMSG_OVERFLOW</td>    <td>?</td></tr><tr>    <td>20</td>    <td>STRINGTABLEMSG_OVERFLOW</td>    <td>?</td></tr><tr>    <td>21</td>    <td>DELTAENTMSG_OVERFLOW</td>    <td>?</td></tr><tr>    <td>22</td>    <td>TEMPENTMSG_OVERFLOW</td>    <td>?</td></tr><tr>    <td>23</td>    <td>SOUNDSMSG_OVERFLOW</td>    <td>?</td></tr><tr>    <td>24</td>    <td>SNAPSHOTOVERFLOW</td>    <td>可靠的快照溢出错误</td></tr><tr>    <td>25</td>    <td>SNAPSHOTERROR</td>    <td>发送快照时出错</td></tr><tr>    <td>26</td>    <td>RELIABLEOVERFLOW</td>    <td>可靠的缓冲溢出错误</td></tr><tr>    <td>27</td>    <td>BADDELTATICK</td>    <td>客户端增量标记故障</td></tr><tr>    <td>28</td>    <td>NOMORESPLITS</td>    <td>没有更多的扩散槽位</td></tr><tr>    <td>29</td>    <td>TIMEDOUT</td>    <td>无法与游戏服务器建立连接。</td></tr><tr>    <td>30</td>    <td>DISCONNECTED</td>    <td>远程主机关闭了连接。</td></tr><tr>    <td>31</td>    <td>LEAVINGSPLIT</td>    <td>扩散槽位已断开</td></tr><tr>    <td>32</td>    <td>DIFFERENTCLASSTABLES</td>    <td>服务器端使用不同的类表。</td></tr><tr>    <td>33</td>    <td>BADRELAYPASSWORD</td>    <td>中继密码错误</td></tr><tr>    <td>34</td>    <td>BADSPECTATORPASSWORD</td>    <td>观察者密码错误</td></tr><tr>    <td>35</td>    <td>HLTVRESTRICTED</td>    <td>SourceTV服务器仅限本地观察者（C类）</td></tr><tr>    <td>36</td>    <td>NOSPECTATORS</td>    <td>比赛不允许观战。</td></tr><tr>    <td>37</td>    <td>HLTVUNAVAILABLE</td>    <td>没有可用的SourceTV中继站</td></tr><tr>    <td>38</td>    <td>HLTVSTOP</td>    <td>SourceTV停止</td></tr><tr>    <td>39</td>    <td>KICKED</td>    <td>被服务器踢出。</td></tr><tr>    <td>40</td>    <td>BANADDED</td>    <td>已加入封禁名单</td></tr><tr>    <td>41</td>    <td>KICKBANADDED</td>    <td>已被踢出并封禁</td></tr><tr>    <td>42</td>    <td>HLTVDIRECT</td>    <td>SourceTV无法直接连接至游戏。</td></tr><tr>    <td>43</td>    <td>PURESERVER_CLIENTEXTRA</td>    <td>纯服务器：客户端加载了额外文件。</td></tr><tr>    <td>44</td>    <td>PURESERVER_MISMATCH</td>    <td>纯服务器：客户端文件与服务器不匹配。</td></tr><tr>    <td>45</td>    <td>USERCMD</td>    <td>解析用户指令错误。</td></tr><tr>    <td>46</td>    <td>REJECTED_BY_GAME</td>    <td>连接被游戏拒绝。</td></tr><tr>    <td>47</td>    <td>MESSAGE_PARSE_ERROR</td>    <td>解析消息失败。</td></tr><tr>    <td>48</td>    <td>INVALID_MESSAGE_ERROR</td>    <td>消息无效。</td></tr><tr>    <td>49</td>    <td>BAD_SERVER_PASSWORD</td>    <td>服务器密码错误</td></tr><tr>    <td>50</td>    <td>DIRECT_CONNECT_RESERVATION</td>    <td>（这会在客户端留下一个空白的确认窗口）</td></tr><tr>    <td>51</td>    <td>CONNECTION_FAILURE</td>    <td>连接失败</td></tr><tr>    <td>52</td>    <td>NO_PEER_GROUP_HANDLERS</td>    <td>缺少连接对等组</td></tr><tr>    <td>53</td>    <td>RECONNECTION</td>    <td>（这会在客户端留下一个空白的确认窗口）</td></tr><tr>    <td>54</td>    <td>LOOPSHUTDOWN</td>    <td>循环关闭。</td></tr><tr>    <td>55</td>    <td>LOOPDEACTIVATE</td>    <td>循环已失效。</td></tr><tr>    <td>56</td>    <td>HOST_ENDGAME</td>    <td>游戏由主机结束。</td></tr><tr>    <td>57</td>    <td>LOOP_LEVELLOAD_ACTIVATE</td>    <td>循环等级加载已生效。</td></tr><tr>    <td>58</td>    <td>CREATE_SERVER_FAILED</td>    <td>创建服务器失败。</td></tr><tr>    <td>59</td>    <td>EXITING</td>    <td>关闭游戏。（玩家quit指令会触发）</td></tr><tr>    <td>60</td>    <td>REQUEST_HOSTSTATE_IDLE</td>    <td>主机空闲中。</td></tr><tr>    <td>61</td>    <td>REQUEST_HOSTSTATE_HLTVRELAY</td>    <td>主机是中继站。</td></tr><tr>    <td>62</td>    <td>CLIENT_CONSISTENCY_FAIL</td>    <td>客户端一致性检查失败。</td></tr><tr>    <td>63</td>    <td>CLIENT_UNABLE_TO_CRC_MAP</td>    <td>客户端地图验证失败。</td></tr><tr>    <td>64</td>    <td>CLIENT_NO_MAP</td>    <td>您的客户端上缺少所需的地图。</td></tr><tr>    <td>65</td>    <td>CLIENT_DIFFERENT_MAP</td>    <td>您的地图版本与服务器不同。</td></tr><tr>    <td>66</td>    <td>SERVER_REQUIRES_STEAM</td>    <td>客户端和服务器必须连接到Steam。</td></tr><tr>    <td>67</td>    <td>STEAM_DENY_MISC</td>    <td>服务器连接被Steam拒绝。</td></tr><tr>    <td>68</td>    <td>STEAM_DENY_BAD_ANTI_CHEAT</td>    <td>服务器连接被VAC拒绝。</td></tr><tr>    <td>69</td>    <td>SERVER_SHUTDOWN</td>    <td>从游戏服务器断开。游戏服务器正在关机。</td></tr><tr>    <td>71</td>    <td>REPLAY_INCOMPATIBLE</td>    <td>不兼容回放。</td></tr><tr>    <td>72</td>    <td>CONNECT_REQUEST_TIMEDOUT</td>    <td>无法与游戏服务器建立连接。</td></tr><tr>    <td>73</td>    <td>SERVER_INCOMPATIBLE</td>    <td>服务器版本不兼容。</td></tr><tr>    <td>74</td>    <td>LOCALPROBLEM_MANYRELAYS</td>    <td>连接断开，此前已尝试连接不同地区的多个中继服务器，您的网络连接很可能出现问题。</td></tr><tr>    <td>75</td>    <td>LOCALPROBLEM_HOSTEDSERVERPRIMARYRELAY</td>    <td>游戏服务器与客户端使用的主中继服务器失去连接。</td></tr><tr>    <td>76</td>    <td>LOCALPROBLEM_NETWORKCONFIG</td>    <td>请检查网络连接。无法从CDN下载网络配置文件。</td></tr><tr>    <td>77</td>    <td>LOCALPROBLEM_OTHER</td>    <td>已断开连接。可能是本地的网络连接出现问题。</td></tr><tr>    <td>79</td>    <td>REMOTE_TIMEOUT</td>    <td>游戏已停止从远程主机接收通讯。</td></tr><tr>    <td>80</td>    <td>REMOTE_TIMEOUT_CONNECTING</td>    <td>已数次尝试连接，但服务器没有响应。</td></tr><tr>    <td>81</td>    <td>REMOTE_OTHER</td>    <td>已数次尝试连接，但服务器没有响应。</td></tr><tr>    <td>82</td>    <td>REMOTE_BADCRYPT</td>    <td>远程主机的证书不正确或配置错误。</td></tr><tr>    <td>83</td>    <td>REMOTE_CERTNOTTRUSTED</td>    <td>远程主机的证书不能用于验证。</td></tr><tr>    <td>84</td>    <td>UNUSUAL</td>    <td>已断开连接。出现特殊情况。控制台可能会有更多详情。</td></tr><tr>    <td>85</td>    <td>INTERNAL_ERROR</td>    <td>由于内部错误，已断开连接。控制台可能会有更多详情。</td></tr><tr>    <td>128</td>    <td>REJECT_BADCHALLENGE</td>    <td>服务器拒绝了错误的挑战数据包。</td></tr><tr>    <td>129</td>    <td>REJECT_NOLOBBY</td>    <td>服务器没有托管游戏大厅。</td></tr><tr>    <td>130</td>    <td>REJECT_BACKGROUND_MAP</td>    <td>服务器正在运行背景图。</td></tr><tr>    <td>131</td>    <td>REJECT_SINGLE_PLAYER</td>    <td>服务器正在运行单人游戏。</td></tr><tr>    <td>132</td>    <td>REJECT_HIDDEN_GAME</td>    <td>服务器正在运行隐藏游戏。</td></tr><tr>    <td>133</td>    <td>REJECT_LANRESTRICT</td>    <td>服务器仅限局域网游戏。</td></tr><tr>    <td>134</td>    <td>REJECT_BADPASSWORD</td>    <td>密码错误被服务器拒绝。</td></tr><tr>    <td>135</td>    <td>REJECT_SERVERFULL</td>    <td>服务器已满。</td></tr><tr>    <td>136</td>    <td>REJECT_INVALIDRESERVATION</td>    <td>服务器预留无效。</td></tr><tr>    <td>137</td>    <td>REJECT_FAILEDCHANNEL</td>    <td>网络信道不良被服务器拒绝。</td></tr><tr>    <td>138</td>    <td>REJECT_CONNECT_FROM_LOBBY</td>    <td>服务器需要客户端从游戏大厅连接。</td></tr><tr>    <td>139</td>    <td>REJECT_RESERVED_FOR_LOBBY</td>    <td>服务器已预留给游戏大厅。</td></tr><tr>    <td>140</td>    <td>REJECT_INVALIDKEYLENGTH</td>    <td>无效游戏序列号被服务器拒绝。</td></tr><tr>    <td>141</td>    <td>REJECT_OLDPROTOCOL</td>    <td>您的客户端已过期。</td></tr><tr>    <td>142</td>    <td>REJECT_NEWPROTOCOL</td>    <td>服务器已过期。</td></tr><tr>    <td>143</td>    <td>REJECT_INVALIDCONNECTION</td>    <td>无效连接被服务器拒绝。</td></tr><tr>    <td>144</td>    <td>REJECT_INVALIDCERTLEN</td>    <td>无效的客户端证书被服务器拒绝。</td></tr><tr>    <td>145</td>    <td>REJECT_INVALIDSTEAMCERTLEN</td>    <td>无效的Steam证书被服务器拒绝。</td></tr><tr>    <td>146</td>    <td>REJECT_STEAM</td>    <td>Steam拒绝了您与服务器的连接。</td></tr><tr>    <td>147</td>    <td>REJECT_SERVERAUTHDISABLED</td>    <td>服务器认证已禁用。</td></tr><tr>    <td>148</td>    <td>REJECT_SERVERCDKEYAUTHINVALID</td>    <td>游戏序列号验证被服务器拒绝。</td></tr><tr>    <td>149</td>    <td>REJECT_BANNED</td>    <td>您的客户端不允许加入此服务器。</td></tr><tr>    <td>150</td>    <td>KICKED_TEAMKILLING</td>    <td>因杀害了过多队友</td></tr><tr>    <td>151</td>    <td>KICKED_TK_START</td>    <td>因在开局时击杀了一名队友</td></tr><tr>    <td>152</td>    <td>KICKED_UNTRUSTEDACCOUNT</td>    <td>帐户处于“不可信”状态</td></tr><tr>    <td>153</td>    <td>KICKED_CONVICTEDACCOUNT</td>    <td>帐户被定罪</td></tr><tr>    <td>154</td>    <td>KICKED_COMPETITIVECOOLDOWN</td>    <td>玩家处于竞技匹配冷却状态</td></tr><tr>    <td>155</td>    <td>KICKED_TEAMHURTING</td>    <td>因过度攻击队友</td></tr><tr>    <td>156</td>    <td>KICKED_HOSTAGEKILLING</td>    <td>因杀害了过多人质</td></tr><tr>    <td>157</td>    <td>KICKED_VOTEDOFF</td>    <td>已被投票踢出</td></tr><tr>    <td>158</td>    <td>KICKED_IDLE</td>    <td>玩家处于空闲状态</td></tr><tr>    <td>159</td>    <td>KICKED_SUICIDE</td>    <td>因自杀次数过多</td></tr><tr>    <td>160</td>    <td>KICKED_NOSTEAMLOGIN</td>    <td>无效的用户登录</td></tr><tr>    <td>161</td>    <td>KICKED_NOSTEAMTICKET</td>    <td>游戏验证失败</td></tr></table></div>]]></content>
    
    
    
    <tags>
      
      <tag>cs2</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Counter-Strike 2 音频自定义编写与编译</title>
    <link href="/2024/cs2-snd/"/>
    <url>/2024/cs2-snd/</url>
    
    <content type="html"><![CDATA[<h1 id="文件结构"><a href="#文件结构" class="headerlink" title="文件结构"></a>文件结构</h1><p>需要安装 cs2 workshop tools ，然后新建一个空白地图项目，比如叫 <code>xxxx</code>。<br>源文件放在 <code>common\Counter-Strike Global Offensive\content\csgo_addons\xxxx</code> 里。<br>其中 <code>soundevents</code> 文件夹里存放着声音脚本文件 <code>.vsndevts</code> ，可以用，<br><code>sounds</code> 文件夹里放着具体的音频源文件，比如 <code>.mp3 .wav</code> 。  </p><p>看起来起源2引擎依然使用的是和以往一样的 44100 hz 的音频文件。  </p><p>后续编译好的文件会在 <code>common\Counter-Strike Global Offensive\game\csgo_addons\xxxx</code> 里。  </p><h1 id="编写声音脚本-vsndevts"><a href="#编写声音脚本-vsndevts" class="headerlink" title="编写声音脚本 vsndevts"></a>编写声音脚本 vsndevts</h1><p>空白地图项目自带一个叫 <code>soundevents_addon.vsndevts</code> 的声音脚本，里面有飞机音效、鸟叫音效的样例。   </p><p>如果你是要在自己的地图里使用，那么就不要改文件名，就在 <code>soundevents_addon.vsndevts</code> 里编写。<br>如果是要在其他插件里自定义调用，就最好复制出来改个文件名，比如 <code>abc.vsndevts</code>      </p><p><code>soundevents_addon.vsndevts</code> 文件里写了一些说明，有兴趣可以自己看以下。<br>以及可以看看 <a href="https://developer.valvesoftware.com/wiki/Counter-Strike_2_Workshop_Tools/Addon_Sounds">Valve 开发者 wiki 里的说明</a>。   </p><p>起源2 的大部分地方都是使用音频事件 (Sound Event) 来播放的，音频事件里指定了使用什么文件、什么类型、多少音量、什么音效(DSP)。<br>每个音频事件都有一个名字 (Sound Event Name)，由编写者指定，在地图或实体播放的时候按音频事件的名字进行使用。   </p><p>以前还能在地图里使用直接的音频文件名播放，现在就别想了。实体连音量都改不了，只能在脚本里预先写好。   </p><p>一个最简单的音频事件的格式示例：    </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-string">&quot;exgze.cheer&quot;</span> =  <span class="hljs-comment">// 音频事件的名字，尽量以 a.b 或者 a.b.c 来编写</span><br>&#123;<br>    type = <span class="hljs-string">&quot;csgo_music&quot;</span>  <span class="hljs-comment">// 类型</span><br>    volume = <span class="hljs-number">1.0</span>     <span class="hljs-comment">// 音量</span><br>    vsnd_files =   <span class="hljs-comment">// 使用的文件，如果是多个会在播放的时候随机选其中一个。</span><br>    [<br>        <span class="hljs-string">&quot;sounds/exg/cheer/1.vsnd&quot;</span>,  <span class="hljs-comment">// 文件必须是 .vsnd 结尾，不管源文件是什么</span><br>        <span class="hljs-string">&quot;sounds/exg/cheer/2.vsnd&quot;</span>  <span class="hljs-comment">// 因为后面我们会编译，把普通格式变成 .vsnd_c</span><br>    ]<br>&#125;<br></code></pre></td></tr></table></figure><p>声音类型有三种：<br><code>csgo_mega</code> 常规3D范围音效。站的越近声音越大。<br><code>csgo_music</code> 表示对任何人来说播放都是一样的效果。适合播放UI音效、音乐、音乐盒。<br><code>csgo_3d</code> wiki 里说这是环境背景音，然而官方vpk里没有一个脚本是使用了这个。<br>而且我发现使用了 <code>csgo_3d</code> 之后，连 hammer 都不承认它存在了，说明可能是个被放弃的早期版本。   </p><p>需要注意的是， <code>csgo_music</code> 使用 <code>vsnd_files</code> 来表示音频文件列表，<br>而 <code>csgo_mega</code> 使用 <code>vsnd_files_track_01</code> 来表示。<br>这个写反了就当没有音频文件了。   </p><h2 id="音量"><a href="#音量" class="headerlink" title="音量"></a>音量</h2><p><code>csgo_music</code> 类型的音量默认受玩家参数 <code>snd_musicvolume</code> 的控制。<br>这些声音脚本有很多参数的功能是未知的，我也是在摸索，比如我发现我自己写 <code>volume_convar</code> 就不好使。<br>可能是因为我们调用这些音频都是来自实体，所以都被游戏认为是 music ，而不是 ui 或者别的音频通道了。   </p><p><code>volume</code> 默认是 1 ，可以写比 1 低也可以写比 1 高。（我印象中以前音量都是只能低不能高的）   </p><h2 id="声音播放范围"><a href="#声音播放范围" class="headerlink" title="声音播放范围"></a>声音播放范围</h2><p><code>distance_volume_mapping_curve</code> 指的是距离和音量的映射曲线。<br>需要像下面这样写，其实我也不太懂这个曲线到底是个什么种类的曲线。<br>映射关系的每个元素有6个数字，就只需要改头两个数字，第一个数字是距离，第二个数字是音量。<br>下面的样例代码里表示的是最远到 900 距离开外听见，音量逐步减小。  </p><p>如果不写这个的话，貌似默认的 <code>csgo_mega</code> 只有 128 距离那么远。   </p><p>甚至可以再加入元素使得声音大小起起伏伏（比如站的最近声音小，站中间声音大）。   </p><p>如果写一个 99999 距离也是 1.0 音量，则表示全图可以听见，但是这个和 music 还是有区别的。<br>玩家听到的声音的左右声道的大小是不一致的，因为他们不一定面向声源。   </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-string">&quot;exgze.test10mega&quot;</span> = <br>&#123;<br>    type = <span class="hljs-string">&quot;csgo_mega&quot;</span><br>    volume = <span class="hljs-number">1.0</span> <span class="hljs-comment">// 这里会被当做标准值，后面曲线会乘以这个数</span><br>    vsnd_files_track_01 = <span class="hljs-string">&quot;sounds/exg/test10s.vsnd&quot;</span><br>    distance_volume_mapping_curve = <br>    [<br>        [<br>            <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-comment">// 距离声音原点零距离时，音量为1.0</span><br>             <span class="hljs-number">-0.00394</span>, <span class="hljs-number">-0.00394</span>, <span class="hljs-comment">// 后面4个数字是照抄的，不知道什么意思</span><br>            <span class="hljs-number">2.0</span>, <span class="hljs-number">3.0</span>,<br>        ],<br>        [<br>            <span class="hljs-number">900.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-comment">// 距离声音原点距离 900 单位时，音量为零</span><br>             <span class="hljs-number">-0.002991</span>, <span class="hljs-number">-0.002991</span>,<br>            <span class="hljs-number">2.0</span>, <span class="hljs-number">3.0</span>,<br>        ]<br>    ]<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="一些官方示例"><a href="#一些官方示例" class="headerlink" title="一些官方示例"></a>一些官方示例</h2><p>一个官方的音乐盒的示例：   </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c++">Music.MVPPreview.halflife_alyx_01 = <br>&#123;<br>    type = <span class="hljs-string">&quot;csgo_music&quot;</span><br>    volume = <span class="hljs-number">0.800000</span><br>    volume_convar = <span class="hljs-string">&quot;snd_menumusic_volume&quot;</span>  <span class="hljs-comment">// 这里是说它同时受玩家设置里的音乐音量的控制</span><br>    stop_music = <span class="hljs-string">&quot;true&quot;</span><br>    vsnd_files = <span class="hljs-string">&quot;sounds/music/halflife_alyx_01/roundmvpanthem_01.vsnd&quot;</span><br>    vsnd_duration = <span class="hljs-number">16.692245</span>  <span class="hljs-comment">// 音乐长度，我们一般不写，编译的时候会自动进去</span><br>&#125;<br></code></pre></td></tr></table></figure><p>一个官方的示例，人质受伤（精简过，原文有点长）：   </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs c++">Hostage.Pain = <br>&#123;<br>    type = <span class="hljs-string">&quot;csgo_mega&quot;</span><br>    volume = <span class="hljs-number">0.899902</span><br>    pitch = <span class="hljs-number">1.000000</span><br>    mixgroup = <span class="hljs-string">&quot;VO&quot;</span><br>    block_duration = <span class="hljs-number">0.300000</span><br>    block_distance = <span class="hljs-number">69.000000</span><br>    use_distance_volume_mapping_curve = <span class="hljs-literal">true</span><br>    reverb_wet = <span class="hljs-number">0.300000</span><br>    display_broadcast = <span class="hljs-literal">true</span><br>    occlusion_intensity = <span class="hljs-number">0.500000</span><br>    occlusion_frequency_scale = <span class="hljs-number">0.500000</span><br>    vsnd_files_track_01 =<br>    [<br>        <span class="hljs-string">&quot;sounds/vo/hostage/hpain/hpain1.vsnd&quot;</span>,<br>        <span class="hljs-string">&quot;sounds/vo/hostage/hpain/hpain2.vsnd&quot;</span>,<br>        <span class="hljs-string">&quot;sounds/vo/hostage/hpain/hpain3.vsnd&quot;</span><br>    ]<br>    distance_volume_mapping_curve = <br>    [<br>        [<br>            <span class="hljs-number">81.028969</span>,<br>            <span class="hljs-number">1.000000</span>,<br>            <span class="hljs-number">0.000000</span>,<br>            <span class="hljs-number">0.000000</span>,<br>            <span class="hljs-number">2.000000</span>,<br>            <span class="hljs-number">3.000000</span>,<br>        ],<br>        [<br>            <span class="hljs-number">211.771500</span>,<br>            <span class="hljs-number">0.634147</span>,<br>            <span class="hljs-number">-0.001725</span>,<br>            <span class="hljs-number">-0.001725</span>,<br>            <span class="hljs-number">2.000000</span>,<br>            <span class="hljs-number">3.000000</span>,<br>        ],<br>        [<br>            <span class="hljs-number">1100.000000</span>,<br>            <span class="hljs-number">0.000000</span>,<br>            <span class="hljs-number">-0.000557</span>,<br>            <span class="hljs-number">-0.000557</span>,<br>            <span class="hljs-number">2.000000</span>,<br>            <span class="hljs-number">3.000000</span>,<br>        ]<br>    ]<br>    vsnd_duration = <span class="hljs-number">0.586757</span><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="编译脚本与声音"><a href="#编译脚本与声音" class="headerlink" title="编译脚本与声音"></a>编译脚本与声音</h1><p>在 <code>Asserts Browser</code> 里搜索你的声音文件和脚本文件。<br>全部选中，按鼠标右键，选择 <code>Full Recompile</code>。   </p><p>这样  <code>.vsndevts</code> 就会变成 <code>.vsndevts_c</code>文件，<br><code>.mp3 .wav</code> 就会变成 <code>.vsnd_c</code> 文件（内嵌进去）了。<br>编译好的文件会在 <code>common\Counter-Strike Global Offensive\game\csgo_addons\xxxx</code> 里。  </p><p>一般来说如果开着 hammer，对 <code>.vsndevts</code> 的编译是全自动的。   </p><p><img src="/image/vsnd1.webp">   </p><h1 id="试听"><a href="#试听" class="headerlink" title="试听"></a>试听</h1><p>如果要试听，可以把要试听的部分编辑到 <code>soundevents_addon.vsndevts</code> 里面，<br>然后在 hammer 里加个声音实体，打开 <code>Sound Event Picker</code> 试听。<br>如果 Picker 里找不到，试试重新编译一次，应该是会每次打开 Picker 的时候刷新的。<br>如果点击了没有声音预览，说明你写的有问题或者音频文件有问题。   </p><p><img src="/image/vsnd2.webp">   </p><h1 id="实体兼容性"><a href="#实体兼容性" class="headerlink" title="实体兼容性"></a>实体兼容性</h1><p><code>snd_event_point</code> 和 <code>ambient_generic</code> 都可以正常播放 mega 和 music 。<br>但是在使用 <code>ambient_generic</code> 的时候一定要注意正确勾选 <code>Is NOT Looped(32)</code> （貌似绝大多数情况下都要勾上，不然不播放）    </p><p><code>ambient_generic</code> 实体无法干预声音脚本自己的音量和播放范围。   </p><h1 id="模板的使用"><a href="#模板的使用" class="headerlink" title="模板的使用"></a>模板的使用</h1><p>如果我们加了七八个甚至几十个音频事件，他们的播放距离或者某些特殊参数都是一样的，<br>每个音频事件都批量复制 <code>distance_volume_mapping_curve</code> 以及一堆参数，如果后续要批量改动，会很麻烦，<br>这时候就可以使用 <code>base</code> 来制作模板。 比如下面，两个音频事件都引用了同一个模板叫 t1base  </p><p>如果是服务器加载了多个不同的 .vsndevts_c ，里面的 base 名字重复了，<strong>会有影响</strong>，可能会互相串参数</p><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs excel"><span class="hljs-string">&quot;t1base&quot;</span> = <br>&#123;<br>    <span class="hljs-built_in">type</span> = <span class="hljs-string">&quot;csgo_mega&quot;</span><br>    volume = <span class="hljs-number">1.00</span><br>    distance_volume_mapping_curve = <br>    [<br>        [<br>            <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,<br>            <span class="hljs-number">2.0</span>, <span class="hljs-number">3.0</span>,<br>        ],<br>        [<br>            <span class="hljs-number">1300</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,<br>            <span class="hljs-number">2.0</span>, <span class="hljs-number">3.0</span>,<br>        ]<br>    ]<br>&#125;<br><br><span class="hljs-string">&quot;vvv.a1&quot;</span>=<br>&#123;<br><span class="hljs-built_in">base</span> = <span class="hljs-string">&quot;t1base&quot;</span><br>vsnd_files_track_01 = <span class="hljs-string">&quot;sounds/exg_hero/amstl/b1.vsnd&quot;</span><br>&#125;<br><br><span class="hljs-string">&quot;vvv.a2&quot;</span>=<br>&#123;<br><span class="hljs-built_in">base</span> = <span class="hljs-string">&quot;t1base&quot;</span><br>vsnd_files_track_01 = <span class="hljs-string">&quot;sounds/exg_hero/amstl/b2.vsnd&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>code</tag>
      
      <tag>cs2</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>小小说：要你管！</title>
    <link href="/2024/notfriend/"/>
    <url>/2024/notfriend/</url>
    
    <content type="html"><![CDATA[<p>A: 你和你父母更像朋友还是敌人？   </p><p>B: 更像朋友。   </p><p>A: 是朋友还不让你和我语音？是朋友还不让你女装？是朋友还要你上交工资？<br>你做任何事情都是要偷偷摸摸的背着朋友的是吧。   </p><p>B: 要你管！滚。  </p>]]></content>
    
    
    
    <tags>
      
      <tag>小小说</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mysql 函数实现的 Steam id64/id32 转好友编码</title>
    <link href="/2023/mysqlsteamid/"/>
    <url>/2023/mysqlsteamid/</url>
    
    <content type="html"><![CDATA[<p>直接上代码：   </p><h1 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs sql">delimiter $$<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">function</span> `GetSteamId3FromId32`(str <span class="hljs-type">CHAR</span>(<span class="hljs-number">50</span>)) <span class="hljs-keyword">returns</span> <span class="hljs-type">bigint</span> <span class="hljs-keyword">DETERMINISTIC</span><br>COMMENT <span class="hljs-string">&#x27;把 STEAM_0:1:2 的格式转换为好友代码&#x27;</span><br><span class="hljs-keyword">BEGIN</span><br>    <span class="hljs-keyword">declare</span> middleStr <span class="hljs-type">CHAR</span>(<span class="hljs-number">5</span>);<br>    <span class="hljs-keyword">declare</span> rightStr <span class="hljs-type">CHAR</span>(<span class="hljs-number">20</span>);<br>    <span class="hljs-keyword">declare</span> num1 <span class="hljs-type">int</span>;<br>    <span class="hljs-keyword">declare</span> num2 <span class="hljs-type">int</span>;<br>    if <span class="hljs-keyword">CHAR_LENGTH</span>(str) <span class="hljs-operator">&lt;</span> <span class="hljs-number">3</span> <span class="hljs-keyword">then</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">end</span> if;<br>    <span class="hljs-keyword">set</span> rightStr <span class="hljs-operator">=</span> SUBSTRING_INDEX(str, <span class="hljs-string">&#x27;:&#x27;</span>, <span class="hljs-number">-1</span>);<br>    <span class="hljs-keyword">set</span> middleStr <span class="hljs-operator">=</span> MID(str, <span class="hljs-keyword">CHAR_LENGTH</span>(str) <span class="hljs-operator">-</span> <span class="hljs-keyword">CHAR_LENGTH</span>(rightStr)<span class="hljs-operator">-</span> <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">set</span> num1 <span class="hljs-operator">=</span> <span class="hljs-built_in">CAST</span>(rightStr <span class="hljs-keyword">as</span> SIGNED);<br>    <span class="hljs-keyword">set</span> num2 <span class="hljs-operator">=</span> <span class="hljs-built_in">CAST</span>(middleStr <span class="hljs-keyword">as</span> SIGNED);<br>    <span class="hljs-keyword">RETURN</span> num1 <span class="hljs-operator">*</span> <span class="hljs-number">2</span> <span class="hljs-operator">+</span> num2;<br><span class="hljs-keyword">END</span> $$<br>delimiter ;<br><br>delimiter $$<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">function</span> `GetSteamId3FromId64`(<span class="hljs-keyword">old</span> <span class="hljs-type">bigint</span>) <span class="hljs-keyword">returns</span> <span class="hljs-type">bigint</span> <span class="hljs-keyword">DETERMINISTIC</span><br>COMMENT <span class="hljs-string">&#x27;把17位steam id64的数字转换为好友代码&#x27;</span><br><span class="hljs-keyword">BEGIN</span><br>    <span class="hljs-keyword">declare</span> num <span class="hljs-type">bigint</span>;<br>    if <span class="hljs-keyword">old</span> <span class="hljs-operator">&lt;</span> <span class="hljs-number">76000000000000000</span> <span class="hljs-keyword">then</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">end</span> if;<br>    <span class="hljs-keyword">set</span> num <span class="hljs-operator">=</span> <span class="hljs-keyword">old</span> <span class="hljs-operator">&lt;&lt;</span> <span class="hljs-number">32</span>;<br>    <span class="hljs-keyword">set</span> num <span class="hljs-operator">=</span> num <span class="hljs-operator">&gt;&gt;</span> <span class="hljs-number">32</span>;<br>    if num <span class="hljs-operator">&lt;</span> <span class="hljs-number">1</span> <span class="hljs-keyword">then</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">end</span> if;<br>    <span class="hljs-keyword">return</span> num;<br><span class="hljs-keyword">END</span> $$<br>delimiter ;<br></code></pre></td></tr></table></figure><h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 第1个例子，我自己的 steam id</span><br><span class="hljs-keyword">select</span> GetSteamId3FromId32(<span class="hljs-string">&#x27;STEAM_0:1:69600329&#x27;</span>) <span class="hljs-keyword">as</span> `a`,<br>  GetSteamId3FromId32(<span class="hljs-string">&#x27;abcd1:69600329&#x27;</span>) <span class="hljs-keyword">as</span> `b`, <br>  GetSteamId3FromId32(<span class="hljs-string">&#x27;1:69600329&#x27;</span>) <span class="hljs-keyword">as</span> `c`,<br>  GetSteamId3FromId64(<span class="hljs-number">76561198099466387</span>) <span class="hljs-keyword">as</span> `d`,<br>  GetSteamId3FromId64(<span class="hljs-string">&#x27;76561198099466387&#x27;</span>) <span class="hljs-keyword">as</span> `e`;<br><br><span class="hljs-comment">-- 第2个例子，批量转换</span><br><span class="hljs-keyword">SELECT</span> `authid`, GetSteamId3FromId32(`authid`) <span class="hljs-keyword">AS</span> `fcode` <br>  <span class="hljs-keyword">FROM</span> `xxx` LIMIT <span class="hljs-number">10</span>;<br></code></pre></td></tr></table></figure><p><img src="/image/mysqlsteam1.webp">   </p><p><img src="/image/mysqlsteam2.webp">   </p><h1 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">function</span> if <span class="hljs-keyword">exists</span> `GetSteamId3FromId32`;<br><span class="hljs-keyword">drop</span> <span class="hljs-keyword">function</span> if <span class="hljs-keyword">exists</span> `GetSteamId3FromId64`;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>code</tag>
      
      <tag>MYSQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>在 CMD 里复制文件夹</title>
    <link href="/2023/copyincmd/"/>
    <url>/2023/copyincmd/</url>
    
    <content type="html"><![CDATA[<p>要把一个文件夹及里面的子文件、子文件夹、子文件夹里的子文件、子文件夹全部复制到另外一个地方。<br>用 cmd 要怎么实现？    </p><p>第一反应是 <code>copy</code> ，然而它只能复制文件夹里的文件，不能复制文件夹里的文件夹。   </p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cmd">&gt;<span class="hljs-built_in">copy</span> t1/* t2 /y<br>The syntax of the command is incorrect.<br><br>&gt;<span class="hljs-built_in">copy</span> t1\* t2&quot; /y<br>t1\a.txt<br>        <span class="hljs-number">1</span> file(s) copied.<br></code></pre></td></tr></table></figure><p>经过一番搜索，正确的做法是：   </p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cmd">&gt;<span class="hljs-built_in">xcopy</span> t1 t2 /y/c/s/e<br>t1\a.txt<br>t1\t9\New Text Document - <span class="hljs-built_in">Copy</span> (<span class="hljs-number">2</span>).txt<br>t1\t9\New Text Document - <span class="hljs-built_in">Copy</span> (<span class="hljs-number">3</span>).txt<br>t1\t9\New Text Document - <span class="hljs-built_in">Copy</span>.txt<br>t1\t9\New Text Document.txt<br>t1\t9 - <span class="hljs-built_in">Copy</span>\New Text Document - <span class="hljs-built_in">Copy</span> (<span class="hljs-number">2</span>).txt<br>t1\t9 - <span class="hljs-built_in">Copy</span>\New Text Document - <span class="hljs-built_in">Copy</span> (<span class="hljs-number">3</span>).txt<br>t1\t9 - <span class="hljs-built_in">Copy</span>\New Text Document - <span class="hljs-built_in">Copy</span>.txt<br>t1\t9 - <span class="hljs-built_in">Copy</span>\New Text Document.txt<br><span class="hljs-number">9</span> File(s) copied<br></code></pre></td></tr></table></figure><p><code>/s</code> 参数是复制目录和子目录，除非它们是空的。<br><code>/e</code> 复制所有子目录，即使它们是空的。    </p><p>xcopy 的微软官方文档：<a href="https://learn.microsoft.com/zh-cn/windows-server/administration/windows-commands/xcopy">点我</a>   </p><p>而且 cmd 还有一个不一样的地方，就是很多cmd指令只承认 <code>\</code> 字符作为路径分隔符，它不承认 <code>/</code> 字符。   </p><p>为什么我要用 cmd 复制个文件夹呢，因为我发现 .NET C# 的 <code>System.IO</code> 里没有复制文件夹的功能（但是它居然有 Move 整个文件夹的功能）。<br>官方是给了个<a href="https://learn.microsoft.com/zh-cn/dotnet/standard/io/how-to-copy-directories">示例函数</a>来做这个事情。<br>我以为用 cmd 能简单一些，结果也这么多麻烦事情。   </p><p>但是 .NET VB 可真就简单多了。<br><code>Microsoft.VisualBasic.FileIO</code> 里就有直接复制整个文件夹的功能：<code>FileSystem.CopyDirectory(src,dest)</code>   </p><p>Powershell 也简单：   </p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">Copy-Item</span> .\t1\* .\t2 <span class="hljs-literal">-Recurse</span> <span class="hljs-literal">-Force</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>code</tag>
      
      <tag>.net</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>从QQ空间网页导出QQ好友列表</title>
    <link href="/2023/exportqq/"/>
    <url>/2023/exportqq/</url>
    
    <content type="html"><![CDATA[<p>以前我都是用QQ邮箱网页版来导出QQ好友列表做备份的。（把全部的好友添加到邮箱通讯录，然后导出邮箱通讯录即可）<br>然而我今天发现这个不好使了。他们断开了QQ邮箱网页版和QQ好友列表的关联。下面这个窗口不断弹出。  </p><p><img src="/image/qqexport1.webp">  </p><p>我想到了另外一个老古董，QQ空间。经过一番鼓捣，找到了具体的XHR请求网址。<br>首先到网页版登录<a href="https://i.qq.com/">QQ空间</a>，<br>如果你没有开通QQ空间也没有关系，也可以登录而不开通，里面也是可以看见别人的说说、相册的。<br>你甚至可以不开通空间的情况下自己发说说，就是别人看不见。<br>登录进来之后按F12进入开发者工具，找到 Network 区域准备抓包。  </p><p><img src="/image/qqexport2.webp">   </p><p>接下来点击好友动态，准备发一条说说。点一下 @ 符号，好友列表就从下面冒出来了。<br>在 Network 里搜索一条请求，文件名叫 <code>friend_show_qqfriends.cgi</code>    </p><p><img src="/image/qqexport3.webp">   </p><p>把它的返回内容保存为 .json 文件，就是你的QQ好友列表了。（虽然不是完美的 json ，需要麻烦手动去掉头尾的 callback js 语句）<br>里面的 items 的 uin 数字就是QQ号了。<br>这个功能可能也就QQ空间这种腾讯一直不更新的能做到了。   </p><p>我今天一开始想到的是腾讯文档，他可以选择分享给指定QQ好友，<br>然后也会有一个好友列表，然而它数据里的 QQ UIN 是另外一种算法的数字。不是我们日常使用的QQ号，是经过了某种算法或单纯随机的新的数编号。   </p>]]></content>
    
    
    
    <tags>
      
      <tag>code</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>小小说：死在大学里</title>
    <link href="/2023/deathinuniversity/"/>
    <url>/2023/deathinuniversity/</url>
    
    <content type="html"><![CDATA[<p>A 已经大学毕业几年了，不知道为什么，今天A醒来发现自己在一个陌生的环境里。<br>这里是一所大学，A知道这所大学在他居住的城市里，A决定离开这里然后回家。   </p><p>A 沿着大路走到了大学门口，但是保安拦住了他。   </p><p>保安：“你是老师还是学生？你的身份卡呢？”    </p><p>A ：“我是社会人士，我没有身份卡。”   </p><p>保安：“胡说，我们这里每个人都有身份卡或校牌，没有校长邀请也根本不会有任何社会人士，你没有就不准出去，而且现在是上课期间，赶快回到你的教室。”   </p><p>A ：“大学居然还有这种出门要身份卡的道理？这是什么狗屁大学！”   </p><p>保安给了A一拳，然后把A拽到了主任室。   </p><p>学校的一个什么高官来了，对A说：“我是梁主任，你好好交代一下你做了什么。”    </p><p>A：“我说了我是社会人士，我不知道为什么我来到了大学里面，我也没有身份卡。”    </p><p>梁：“我们大学严格执行封闭式管理，连外卖和快递都进不来。我认识全校每个教职工，你不是老师，你只能是学生。”   </p><p>A：“我说了我是学校外面来的，我不是里面的学生。”    </p><p>梁挥挥手，叫保安把A又打了一顿。   </p><p>梁：“我再给你一次机会，你不说你是哪个班的学生的话我就打断你的腿。全城的人都知道我们大学的管理不是好惹的。”    </p><p>A： “你敢不敢报警，叫警察来查查我是不是学生。”   </p><p>梁：“你还想报警？弄坏了大学的名声你负责的起吗？”    </p><p>梁把A的照片发到了班主任群里，问这是哪个班的。同时把A锁在了禁闭室里。   </p><p>第二天梁才回来，没有一个班主任表示认识照片这个人。也没有一个班主任表示有学生走失。   </p><p>这下梁慌了，赶快打开禁闭室的门，发现A已经昏过去了，可能是冻的也可能是饿的。   </p><p>梁又赶快把门重新锁上，然后去找校长，说明了情况。   </p><p>校长：“你干脆就把他彻底杀了，尸体随便分尸或者泡盐酸或者捐了做标本。”   </p><p>梁：“为什么啊，这么着急就把他杀了？”    </p><p>校长：“他要是个学生或者学生家长，我们捏着他的毕业证。可他是个社会人士，你有他的软肋吗？他出去把我们做的事情说给电视台怎么办？”   </p><p>梁：“校长，那这..”   </p><p>校长：“梁主任，我们的前程重要还是这个无名氏重要啊？全校的监控你爱删多少删多少，都不是事。”   </p><p>就这样，A失踪了。A 的家人去寻找过A，但是没有人知道A到底在哪里。    </p>]]></content>
    
    
    
    <tags>
      
      <tag>小小说</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GMod LUA 武器自动发射子弹的问题</title>
    <link href="/2023/gmodswepsound/"/>
    <url>/2023/gmodswepsound/</url>
    
    <content type="html"><![CDATA[<p>我发现我自己写的 LUA 脚本武器 SWEP 有个通病，就是按下左键或者右键能听到ti的一声（HL2没弹药的音效）。<br>如果写了 <code>AmmoType</code> 并且我不实际发射弹药，也会看见和听见一颗 AR2 子弹射出去，但是没有任何伤害。   </p><p>以前我的尝试都没有成功，今天我终于找到了异常的根源。   </p><p>原因就是我只在 <code>SERVER</code> 里添置了 <code>SWEP:PrimaryAttack()</code> ，没有在 <code>CLIENT</code> 里添置 <code>SWEP:PrimaryAttack()</code> 。<br>如果不写 <code>SWEP:PrimaryAttack()</code> ， GMod 就会自动按照默认设计，发射一颗子弹（仅仅是客户端的子弹，服务器根本不知道你射了）。同理还有 <code>SWEP:SecondaryAttack()</code>。   </p><p>为什么今天发现了问题呢，是因为我在 <code>SHARED</code> 加了一个 hook ，然后发现只有我的 <code>CLIENT</code> 在报告发射。   </p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs lua">hook.Add(<br>    <span class="hljs-string">&quot;EntityFireBullets&quot;</span>,<br>    <span class="hljs-string">&quot;abcdefgh12354895714896&quot;</span>,<br>    <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ent, data)</span></span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> IsValid(ent) <span class="hljs-keyword">then</span> <span class="hljs-keyword">return</span> <span class="hljs-keyword">end</span><br>        <span class="hljs-built_in">print</span>(ent, <span class="hljs-string">&quot;发射了子弹&quot;</span>)<br>    <span class="hljs-keyword">end</span><br>)<br></code></pre></td></tr></table></figure><p>为什么以前没有发现，是因为以前我都是 <code>SWEP.Primary.ClipSize = -1</code>。<br>以前我的子弹数量都是 -1 ，压根没有子弹，就只能听到HL2没弹药的音效。<br>然后我还tm不知道在哪里关这个音效。   </p><p>为什么别人家的武器都没有这个事情呢。<br>是因为别人都喜欢直接写在 <code>shared.lua</code> 里面。   </p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">SWEP:PrimaryAttack</span><span class="hljs-params">()</span></span><br>    <span class="hljs-keyword">if</span> CLIENT <span class="hljs-keyword">then</span> <span class="hljs-keyword">return</span> <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><p>可不叫离谱吗。   </p><p>气死我了。<br>所以特此写下本文。    </p>]]></content>
    
    
    
    <tags>
      
      <tag>code</tag>
      
      <tag>gmod</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>使用 VSCode+SSH 实现Windows远程写代码</title>
    <link href="/2023/ssh/"/>
    <url>/2023/ssh/</url>
    
    <content type="html"><![CDATA[<p>我的情况：经常要在远程 Windows 上执行修改 LUA 的操作。我自己又没有好的宽带，使用 RDP 经常会和其他人起冲突。   </p><p>解决方案：在服务器上安装 OpenSSH 然后在本地用 vscode 远程进去进行写代码。   </p><h1 id="在服务器安装-OpenSSH"><a href="#在服务器安装-OpenSSH" class="headerlink" title="在服务器安装 OpenSSH"></a>在服务器安装 OpenSSH</h1><p>先下载<a href="https://github.com/PowerShell/Win32-OpenSSH/releases">Win32-OpenSSH 的 MSI 安装包</a>，然后安装到服务器。<br>（直接下最新版就行，我找不到它的正式版 release）   </p><h2 id="如果服务器是-Administrator-用户"><a href="#如果服务器是-Administrator-用户" class="headerlink" title="如果服务器是 Administrator 用户"></a>如果服务器是 Administrator 用户</h2><p>如果服务器运行的是<strong>真高级管理员</strong> <code>Administrator</code> 用户，<br>就这样操作：    </p><p>在服务端上找到文件夹 <code>C:\ProgramData\ssh\</code><br>建立一个空白文件 <code>administrators_authorized_keys</code> ，在里面填上一行自己的公钥。<br>如果需要多个公钥就一行一个。   </p><h2 id="如果服务器是普通的管理员用户"><a href="#如果服务器是普通的管理员用户" class="headerlink" title="如果服务器是普通的管理员用户"></a>如果服务器是普通的管理员用户</h2><p>还是找到 <code>C:\ProgramData\ssh\sshd_config</code> 配置文件<br>在里面注释掉最后两行：   </p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section">#Match Group administrators</span><br><span class="hljs-section">#       AuthorizedKeysFile <span class="hljs-strong">__PROGRAMDATA__</span>/ssh/administrators<span class="hljs-emphasis">_authorized_</span>keys</span><br></code></pre></td></tr></table></figure><p>其次是去 <code>C:\Users\用户名\.ssh</code> 文件夹，新建一个空白文件叫 <code>authorized_keys</code> ，在里面填上一行自己的公钥。<br>如果需要多个公钥就一行一个。   </p><h2 id="禁用密码登录"><a href="#禁用密码登录" class="headerlink" title="禁用密码登录"></a>禁用密码登录</h2><p>如果需要彻底禁用密码登录 ，需要修改配置文件 <code>C:\ProgramData\ssh\sshd_config</code> 。<br>里面找到并修改设置为 <code>PasswordAuthentication no</code> 。   </p><p>如果没有禁用密码访问，可能每次连接的时候都要输入服务端上对应用户的 Windows 登录密码。    </p><h1 id="重启服务"><a href="#重启服务" class="headerlink" title="重启服务"></a>重启服务</h1><p>接下来用服务端的任务管理器重启 <code>sshd</code> 服务。<br>每次修改配置之后都应该重启一次服务。   </p><h1 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h1><p>在自己的电脑上运行命令行指令： <code>ssh username@ip</code><br>需要加端口就是 <code>ssh username@ip -p1234</code><br>username 指的是目标服务器上的用户，比如 <code>Administrator</code> 或者 <code>abc</code> ，不是本机用户名。   </p><p>如果连接成功，则可以进入下一步。   </p><h1 id="VSCode-Remote"><a href="#VSCode-Remote" class="headerlink" title="VSCode Remote"></a>VSCode Remote</h1><p>安装 vscode 扩展：<code>ms-vscode-remote.remote-ssh</code><br>安装之后点击 vscode 左下角的按钮，就可以 <code>Connect To Host</code> 了。<br>他默认读取的是 <code>C:\Users\用户名\.ssh\config</code> 这个配置文件。<br>可以在里面给你的连接起备注名。   </p><p>连接之后如果需要经常重新打开指定的文件夹，可以 <code>Save Workspace As </code> 然后选择 <code>To Local</code> 。<br>这样从本地就可以直接双击打开 <code>.code-workspace</code> 文件进入远程环境了。   </p><p>连接完成之后， vscode 会在远程服务器安装 code-server 作为一个后台辅助。<br>也就意味着可以安装vscode扩展到服务器上，并且扩展数据还是保存在服务器上的。   </p><h1 id="系统要求"><a href="#系统要求" class="headerlink" title="系统要求"></a>系统要求</h1><p>VSCode Remote 需要 <code>Windows 10 / Server 2016/2019 (1803+) </code> 。<br>老版本上的 windows 无法安装 code server ，但是部分版本依然可以安装 Win32-OpenSSH 。   </p><h1 id="垃圾"><a href="#垃圾" class="headerlink" title="垃圾"></a>垃圾</h1><p>vscode 有时候会抽风，在服务器电脑里留下大量重复的垃圾文件，可能占据C盘十几GB。<br>检测一下C盘的 <code>C:\Users\用户名\.vscode-server\bin</code> 文件夹。<br>code server 会把老版本全部留在里面。   </p><p>以及 <code>C:\Users\用户名\AppData\Local\Temp</code> 文件夹。<br>code server 会把老版本、以及时不时抽风重装的文件全部留在里面，以七八个字母加一个小数点再加三个字母作为文件夹名字。<br>比如 <code>jy4wbtpz.qef</code> ，里面你能找到 <code>node.exe</code> 。   </p><h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>如果遇到其他麻烦，请参阅： </p><ul><li><a href="https://learn.microsoft.com/zh-cn/windows-server/administration/openssh/openssh_server_configuration">微软官网说明</a> </li><li><a href="https://github.com/PowerShell/Win32-OpenSSH/wiki">Github wiki</a>   </li><li><a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-ssh">VSCode 扩展说明</a></li></ul><p>或者也可以开启 ssh 的日志。<br>找到 <code>sshd_config</code> 的 <code># Logging</code> 下面两行，改成这样：   </p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gcode">SyslogFacility LOCAL<span class="hljs-number">0</span><br>LogLevel DEBU<span class="hljs-name">G3</span><br></code></pre></td></tr></table></figure><p>日志会输出在 <code>C:\ProgramData\ssh\logs</code> 里面。<br>问题解决了之后最好把日志注释掉，不然浪费C盘空间。    </p>]]></content>
    
    
    
    <tags>
      
      <tag>code</tag>
      
      <tag>ssh</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>小小说：是女朋友就分手</title>
    <link href="/2023/hit/"/>
    <url>/2023/hit/</url>
    
    <content type="html"><![CDATA[<p>A：“我和你说，我感觉我受我女朋友欺负很久了。”   </p><p>B：“怎么了？”   </p><p>A：“她说为了我的健康和未来，不许我出去吃，只能吃她做的饭菜。不让我玩游戏，也不让我买主机。为了以后有个更好的家庭，要我把一切收入交给她管理。”</p><p>B：“这还好吧？”</p><p>A：“只要我反对她，她就说我没出息，她为我做的努力就全白费了。她说她都是为我好。甚至好几次要我下跪，还拿拖鞋打我。”  </p><p>B：“怎么这么暴力啊，都到这地步了还不分手吗”    </p><p>A：“是啊，我也在想分手。 我告诉你个更严重的你想听吗？”  </p><p>B：“你说。我听着。”</p><p>A：“其实我刚才说的是我父母，是他们这么对我的。”</p><p>B：“你这人怎么这样啊，你懂不懂什么叫孝顺啊？父母都是为你好你不知道吗？”</p><p>A：“难道你的意思是，我女朋友对我这样我就应该分手？我父母对我这样我就应该忍着挨着？那假如我是父母有一方是再婚呢？ 不是亲生的也该忍着？”</p><p>B：“不孝子就是不孝子，别狡辩了。”   </p>]]></content>
    
    
    
    <tags>
      
      <tag>小小说</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>小小说：印度草药的故事</title>
    <link href="/2023/india/"/>
    <url>/2023/india/</url>
    
    <content type="html"><![CDATA[<p>小明今天生病了，一直发热加咳嗽。   </p><p>小明的母亲就出去为他买药。    </p><p>母亲出去了不久，一个印度人就来到了小明家的门口。原来是小明的邻居，一个来打工的印度人，之前和小明也有认识。   </p><p>印度人敲敲门，“是我”。 </p><p>小明开门了。    </p><p>印度人说：“我听你一直在咳嗽，我手里有一些草药，是我们印度人世代都使用的配方，你拿去用开水煮开然后喝了就可以了。”    </p><p>小明表示了感谢，收下了印度草药。   </p><p>可是小明也只能继续等他母亲回家，因为小明还小，无法自己煮药。    </p><p>小明的母亲回来了，小明就和母亲说了印度人来拜访的事。    </p><p>小明的母亲看了看手里拿的中草药，再看了看印度人给的印度草药。<br>就把印度草药扔进了垃圾桶。   </p><p>小明问母亲为什么要丢掉它。   </p><p>小明的母亲说：“他们印度草药只能糊弄他们自己人，是帮不了我们的。我们的五千年中医博大精深，不管什么病，不管中国人外国人都是可以治好的。”   </p>]]></content>
    
    
    
    <tags>
      
      <tag>小小说</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>小小说：他被车撞了所以他毕业了</title>
    <link href="/2022/fail/"/>
    <url>/2022/fail/</url>
    
    <content type="html"><![CDATA[<p>一个本科生，以很慢的速度跑过了终点线，气喘吁吁。   </p><p>他的体育老师走过来告诉他：“对不起，你不能毕业了。估计是要留级了。”    </p><p>本科生问：“为什么？”    </p><p>老师说：“因为你体育不及格，期末考试太差，不符合毕业的底线要求。”    </p><p>本科生看见了另外一个本科生，他没有参加跑步以及其他的体育考试项目。本科生指着他，说：“他呢？他都没有参加考试。”    </p><p>老师说：“他申请了免测，他之前被车撞伤了。他直接体育就及格了。”    </p><p>“撞伤？我看他现在活蹦乱跳的，这不是作弊吗！”    </p><p>“只要提交材料的那一天他被车撞伤了，有医院证明就行，我不管他现在是活的是死的。你给我冷静一点。”    </p><p>本科生愤怒地说：“我哪个科目比他差？他被车撞了所以他毕业了，我没被车撞所以我不能毕业！”   </p><p>他昏过去了，因为他实在是太累了。   </p>]]></content>
    
    
    
    <tags>
      
      <tag>小小说</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>小小说：大是大非前谈努力</title>
    <link href="/2022/dsdf/"/>
    <url>/2022/dsdf/</url>
    
    <content type="html"><![CDATA[<p>有个年轻人在一个小公司里面上班。   </p><p>有一天，他的母亲和几个大叔突然一起出现在他公司的门口。<br>他母亲一眼就望见了他，年轻人也看见了他的母亲，那几个大叔里有认识的舅舅，也有不认识的。   </p><p>几个大叔直接奔到年轻人身边，掐住他的脖子，拉住他的手。<br>老板赶紧跑过来问：“怎么回事？你们是谁？来这干什么？”    </p><p>他母亲高声说道：“这是我儿子某某某！他不听我的话，一个人出来鬼混！翅膀硬了要飞了，连亲妈亲爸都不管了！”   </p><p>老板说：“可是他在这里一直表现的很好，工作很努力啊。”    </p><p>年轻人的母亲瞪了回去，喊着：“在大是大非前谈什么努力！不孝子的努力，就是将来的卖国贼！跟我回去，好好教育一下，工资不用结了！”    </p>]]></content>
    
    
    
    <tags>
      
      <tag>小小说</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>小小说：你这个没出息的狗儿子</title>
    <link href="/2022/son/"/>
    <url>/2022/son/</url>
    
    <content type="html"><![CDATA[<p>一位父亲带着他的儿子去逛街。   </p><p>走到了游乐园旁，儿子指着高大的摩天轮说：“爸爸，我想玩摩天轮。”    </p><p>父亲却说：“不行，摩天轮太危险了，不能玩摩天轮。”     </p><p>之后，他们走到了科技馆的墙外，父亲指着墙上的宇航员画像，说：“你以后长大了想不想做航天员？”    </p><p>儿子说：“不想，因为做航天员太危险了。”    </p><p>父亲想都没想就骂了回去：“我没你这个没出息的狗儿子！你不会说几句好话让我开心一下吗！”    </p>]]></content>
    
    
    
    <tags>
      
      <tag>小小说</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>订阅</title>
    <link href="/2021/rss/"/>
    <url>/2021/rss/</url>
    
    <content type="html"><![CDATA[<p>本博客支持以下订阅：   </p><ul><li><a href="/rss.xml">RSS</a></li><li><a href="/atom.xml">Atom</a></li><li><a href="/feed.json">JSON Feed</a></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>code</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>关于我</title>
    <link href="/2021/about/"/>
    <url>/2021/about/</url>
    
    <content type="html"><![CDATA[<p>我是陈布衣，姓陈，号布衣。<br>欢迎参观本博客，虽然没有多少有价值的内容。   </p><p>联系我，请发 email 到 <code>chenbuyi2019艾特outlook.com</code><br>但是，有概率进垃圾邮箱我还看不见。<br>所以你发B站私信也可以哦。  </p><p>链接： <a href="https://weibo.com/u/5977985000">微博</a>、 <a href="https://space.bilibili.com/4523834">B站</a>、 <a href="https://github.com/chenbuyi2019">GitHub</a>、  <a href="/2021/rss">RSS订阅</a></p><p><img src="/image/avatar.webp"></p><h1 id="简史"><a href="#简史" class="headerlink" title="简史"></a>简史</h1><p>2001年，在浙江省出生。<br>2013年，注册 Steam 。<br>2019年，本科大一退学，后来确诊抑郁症。<br>2021年，离家出走，拉黑血亲。定居在云南省昆明市。<br>2023年，学会了骑自行车。<br>2024年，户口迁入昆明市。   </p><p>现在，是一名光荣的自力更生的昆明市市民。昆明就是我的家。   </p><h1 id="理想"><a href="#理想" class="headerlink" title="理想"></a>理想</h1><p>这辈子<br>再不吃父母一口饭，再不花父母一分钱，<br>再不穿父母一件衣，再不回老家一次。  </p><p>不求长命百岁，不求做大官发大财，我只想再也不看父母的脸色过日子。   </p><p><a href="https://m.weibo.cn/status/P2qnOsz6s">写于2024年11月28日</a>   </p><h1 id="StopWatch"><a href="#StopWatch" class="headerlink" title="StopWatch"></a>StopWatch</h1><p>布衣已经入籍昆明市 <span id="tm2"> </span> 。   </p><script>function setA(id, st) {    var w = document.getElementById(id);    var now = new Date();    const year = 86400 * 365;    var passed = (now.getTime() - st.getTime()) / 1000;    var years = passed / year    const nt = 100000000;    years = Math.floor(years * nt) / nt    w.innerText = `${years} 年`;}function updateTimes() {    setA("tm2", new Date("2024-09-04T09:40:00"));}setInterval(updateTimes, 1000);updateTimes();</script><h1 id="我的设备"><a href="#我的设备" class="headerlink" title="我的设备"></a>我的设备</h1><p>布衣现在使用的电脑是自己组装的台式机。   </p><ul><li><a href="https://valid.x86.fr/54qmyp">AMD Ryzen 5 9600X</a></li><li>七彩虹 CVN B650 GAMING FROZEN</li><li>光威 DDR5 6400Mhz 16GB 两根</li><li><a href="https://www.3dmark.com/spy/51361807">NVIDIA GeForce RTX 4070 微星</a></li><li>利民 额定850W TR-TG850</li><li>Lexar SSD THOR PRO 2TB NVMe (PCIe 4x4)</li><li>HKC 27英寸 2K 180Hz FastIPS</li><li>Windows 11</li></ul><p>布衣的手机是 <a href="https://m.weibo.cn/status/Qlr2quPe0">Xiaomi 17 Ultra</a> 。  </p>]]></content>
    
    
    
    <tags>
      
      <tag>关于</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
